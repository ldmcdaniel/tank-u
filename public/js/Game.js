'use strict';

var explosions, money, moneyText, score, scoreText, restartGame, waveNumber;
var nextFire = [];
var wave = 1;
var enemiesKilled = 0;
var pausedGame = false;
for (var i = 0; i < 10; i++) {
  nextFire[i] = 0;
}
PhaserGame.Game = {
  create: function create() {
    this.gameWorld();
  },
  gameWorld: function gameWorld() {
    this.setScale();
    this.makeElements();
    this.createEnemyPlot(this.enemyWave);
    this.scoreAndStats();
    this.createGameMusic();
  },
  makeElements: function makeElements() {
    var map = this.add.tilemap('map');
    this.createMap(map);
    this.createBullets();
    this.createTurrets();
    this.createEnemies();
    map.createLayer('Tree Tops and Bridges').scale.set(this.scale);
  },
  setScale: function setScale() {
    this.scale = 1;
    if (window.innerWidth < 1024 || window.innerHeight < 768) {
      if (window.innerWidth / 1024 > window.innerHeight / 768) {
        this.scale = window.innerHeight / 768;
      } else {
        this.scale = window.innerWidth / 1024;
      }
    }
  },
  createMap: function createMap(map) {
    var _this = this;

    // First param :name of tileset from tiled; second: game.load.image
    map.addTilesetImage('terrain_atlas', 'terrain');
    map.addTilesetImage('turrets32', 'turrets');
    var layers = ['Road', 'Grass', 'Tree bases'];
    layers.forEach(function (layer) {
      return map.createLayer(layer).scale.set(_this.scale);
    });
    this.bmd = this.add.bitmapData(game.width * this.scale, game.height * this.scale);
    this.bmd.addToWorld();
  },
  createBullets: function createBullets() {
    this.bullets = game.add.group();
    var bullets = this.bullets;
    bullets.scale.set(this.scale);
    bullets.enableBody = true;
    bullets.physicsBodyType = Phaser.Physics.ARCADE;
    bullets.createMultiple(2000, 'bullet1');
    bullets.setAll('checkWorldBounds', true);
    bullets.setAll('outOfBoundsKill', true);
  },
  createEnemies: function createEnemies() {
    this.enemies = game.add.group();
    var enemies = this.enemies;
    enemies.scale.set(this.scale);
    enemies.enableBody = true;
    enemies.physicsBodyType = Phaser.Physics.ARCADE;
    // this.enemyWave = ['tank1', 'tank2', 'tank3', 'tank4', 'tank5', 'tank6', 'tank7', 'tank8', 'tank9', 'tank10', 'tank11'];
    var waveNumber = wave - 1;
    console.log(waveNumber);
    this.enemyWave = this.wavesOfWaves()[waveNumber];
    var enemyWave = this.enemyWave;
    enemyWave.forEach(function (enemyString, i) {
      enemyWave[i] = enemies.create(-16, 116, enemyString);
      enemyWave[i].anchor.set(0.5);
      enemyWave[i].animations.add('explosion', false);
      enemyWave[i].health = parseInt(enemyWave[i].key.split('k')[1]);
    });
  },
  wavesOfWaves: function wavesOfWaves() {
    return [['tank8', 'tank10', 'tank8', 'tank11', 'tank10', 'tank8', 'tank23', 'tank10', 'tank8', 'tank10'], ['tank11', 'tank23', 'tank11', 'tank24', 'tank23', 'tank11', 'tank25', 'tank23', 'tank11', 'tank23'], ['tank24', 'tank25', 'tank24', 'tank30', 'tank25', 'tank24', 'tank31', 'tank25', 'tank24', 'tank25']];
  },
  createTurrets: function createTurrets() {
    this.guns = game.add.group();
    var guns = this.guns;
    guns.scale.set(this.scale);
    this.turretPosition = ['turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1'];
    var turretPosition = this.turretPosition;
    this.coinPosition = ['coin', 'coin', 'coin', 'coin', 'coin', 'coin', 'coin', 'coin', 'coin', 'coin'];
    var coinPosition = this.coinPosition;
    this.turretSpots = {
      'x': [352, 800, 256, 448, 96, 320, 128, 354, 832, 864],
      'y': [32, 96, 256, 256, 320, 480, 640, 704, 384, 544]
    };
    var turretSpots = this.turretSpots;
    var createTurret = this.createTurret;
    var scale = this.scale;
    turretPosition.forEach(function (turret, i) {
      turretPosition[i] = guns.create(turretSpots.x[i], turretSpots.y[i], turretPosition[i]);
      turretPosition[i].anchor.set(0.5);
      coinPosition[i] = game.add.button(turretSpots.x[i] * scale, turretSpots.y[i] * scale, coinPosition[i], createTurret);
      coinPosition[i].anchor.set(0.5);
    });
    explosions = game.add.group();
    explosions.scale.set(this.scale);
    explosions.createMultiple(100, 'explosion');
  },
  createScore: function createScore() {
    score = 0;
    scoreText = game.add.text(820 * this.scale, 10 * this.scale, 'Score: ' + score);
  },
  createMoney: function createMoney() {
    money = 40;
    moneyText = game.add.text(412 * this.scale, 10 * this.scale, "$ " + money);
  },
  scoreAndStats: function scoreAndStats() {
    this.createScore();
    this.createMoney();
    waveNumber = game.add.text(30, 10, 'Wave ' + wave);
  },
  createGameMusic: function createGameMusic() {
    this.backgroundMusic = game.add.audio('backgroundMusic', true);
    this.backgroundMusic.play('', 0, 0.2, true);
  },
  createEnemyPlot: function createEnemyPlot(enemies) {
    this.path = [];
    var ix = 0;
    var x = 1 / (game.width + (enemies.length - 1) * 100);
    this.points = {
      'x': [-466, -416, -366, -316, -266, -216, -156, -56, -16, 100, 200, 300, 400, 500, 600, 700, 740, 675, 600, 500, 400, 300, 205, 180, 190, 290, 390, 490, 590, 690, 790, 850, 860, 860, 860, 860, 860, 860, 860, 860, 860, 860],
      'y': [130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 145, 160, 180, 250, 310, 340, 350, 350, 365, 400, 475, 550, 590, 610, 623, 630, 638, 650, 720, 800, 850, 900, 950, 1000, 1050, 1100, 1150, 1200, 1250]
    };
    this.pi = 0;
    for (var i = 0; i <= 1; i += x) {
      var px = this.math.catmullRomInterpolation(this.points.x, i);
      var py = this.math.catmullRomInterpolation(this.points.y, i);
      //This draws the path onto the screen to edit the path
      // this.bmd.rect(px, py, 1, 1, 'rgba(255, 255, 255, 1)');
      var node = { x: px, y: py, angle: 0 };
      if (ix > 0) {
        node.angle = this.math.angleBetweenPoints(this.path[ix - 1], node);
      }
      this.path.push(node);
      ix++;
    }
    // This draws rectangles onto the path where the nodes are located
    // for (var p = 0; p < this.points.x.length; p++) {
    //   this.bmd.rect(this.points.x[p]-3, this.points.y[p]-3, 6, 6, 'rgba(255, 0, 0, 1)');
    // }
  },
  update: function update() {
    if (wave < 3) {
      this.sendEnemyWave();
    } else {
      this.startTankMission(this.enemyWave);
      if (enemiesKilled >= this.enemyWave.length * wave) {
        enemiesKilled = 0;
        game.state.start('GameWon');
      }
    }
  },
  sendEnemyWave: function sendEnemyWave() {
    this.startTankMission(this.enemyWave);
    if (enemiesKilled >= this.enemyWave.length * wave) {
      // map.createLayer('Tree Tops and Bridges').scale.set(this.scale);
      PhaserGame.Game.createEnemyPlot(PhaserGame.Game.enemyWave);
      wave++;
      waveNumber.setText('Wave ' + wave);
      PhaserGame.Game.createEnemies();
    }
  },
  startTankMission: function startTankMission(enemies) {
    for (var i = 0; i < enemies.length; i++) {
      try {
        var offset = this.path[this.pi + ((enemies.length - 1) * 40 - i * 40)];
        enemies[i].x = offset.x;
        enemies[i].y = offset.y;
        enemies[i].rotation = offset.angle;
      } catch (e) {
        game.state.start('GameLost');
      }
    }
    this.pi++;
    var turretPosition = this.turretPosition;
    for (var i = 0; i < enemies.length; i++) {
      for (var j = 0; j < turretPosition.length; j++) {
        if (this.physics.arcade.distanceToXY(enemies[i], turretPosition[j].x, turretPosition[j].y) < 200 && enemies[i].alive === true) {
          turretPosition[j].rotation = game.physics.arcade.angleBetween(turretPosition[j], enemies[i]);
        }
      }
    }
    this.updateTurretAim();
    game.physics.arcade.overlap(this.bullets, this.enemies, this.collisionHandler);
  },
  updateTurretAim: function updateTurretAim() {
    for (var y = 0; y < 10; y++) {
      if (this.coinPosition[y].alive === false) {
        this.aim(y);
      }
    }
  },
  updateMoney: function updateMoney(amount) {
    money -= amount;
    moneyText.setText('$ ' + money);
  },
  createTurret: function createTurret(coin) {
    if (money - 8 >= 0) {
      coin.kill();
      PhaserGame.Game.updateMoney(8);
      game.add.audio('cashRegister').play();
    }
  },
  updateScore: function updateScore(points) {
    score += points;
    scoreText.setText('Score: ' + score);
  },
  collisionHandler: function collisionHandler(bullet, enemy) {
    bullet.kill();
    enemy.health -= 1;
    PhaserGame.Game.updateScore(1);
    if (enemy.health <= 0) {
      game.add.audio('explosion').play('', 0, 0.4);
      enemy.kill();
      enemiesKilled += 1;
      PhaserGame.Game.updateScore(5);
      PhaserGame.Game.updateMoney(-5);
      var explosion = explosions.getFirstExists(false);
      explosion.reset(enemy.body.x - 70, enemy.body.y - 70);
      explosion.animations.add('explosion');
      explosion.animations.play('explosion', null, false, true);
    }
  },
  aim: function aim(x) {
    var turretPosition = this.turretPosition[x];
    if (game.time.now > nextFire[x] && this.bullets.countDead() > 0) {
      var bullet = this.bullets.getFirstDead();
      var fireRate = 300;
      nextFire[x] = game.time.now + fireRate;
      bullet.anchor.set(0.5);
      bullet.reset(turretPosition.x, turretPosition.y);
      // Try decrimenting the function to have it aim at the first turret
      for (var i = 0; i < this.enemyWave.length; i++) {
        var enemy = this.enemyWave[i];
        if (this.physics.arcade.distanceToXY(enemy, turretPosition.x, turretPosition.y) < 200 && enemy.alive === true && enemy.x > 0 && enemy.y < 768) {
          bullet.rotation = game.physics.arcade.angleBetween(turretPosition, enemy);
          game.physics.arcade.moveToObject(bullet, enemy, 300);
          game.add.audio('shot').play('', 0, 0.05);
        }
      }
    }
  }
};

game.state.add('Game', PhaserGame.Game);
//# sourceMappingURL=data:application/json;base64,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LEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztBQUM5TixTQUFHLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQztLQUM5TixDQUFDO0FBQ0YsUUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDWixTQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDOUIsVUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUMvRCxVQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDOzs7QUFHL0QsVUFBTSxJQUFJLEdBQUcsRUFBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBQyxDQUFDO0FBQ3RDLFVBQUksRUFBRSxHQUFHLENBQUMsRUFBRTtBQUNWLFlBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztPQUNwRTtBQUNELFVBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3JCLFFBQUUsRUFBRSxDQUFDO0tBQ047Ozs7O0dBS0Y7QUFDRCxRQUFNLEVBQUEsa0JBQUc7QUFDUCxRQUFJLElBQUksR0FBRyxDQUFDLEVBQUU7QUFDWixVQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7S0FDdEIsTUFBTTtBQUNMLFVBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDdEMsVUFBSSxhQUFhLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxFQUFFO0FBQ2pELHFCQUFhLEdBQUcsQ0FBQyxDQUFDO0FBQ2xCLFlBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO09BQzdCO0tBQ0Y7R0FDRjtBQUNELGVBQWEsRUFBQSx5QkFBRztBQUNkLFFBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDdEMsUUFBSSxhQUFhLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxFQUFFOztBQUVqRCxnQkFBVSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUMzRCxVQUFJLEVBQUUsQ0FBQztBQUNQLGdCQUFVLENBQUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQztBQUNuQyxnQkFBVSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztLQUNqQztHQUNGO0FBQ0Qsa0JBQWdCLEVBQUEsMEJBQUMsT0FBTyxFQUFFO0FBQ3hCLFNBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQ3ZDLFVBQUk7QUFDRixZQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQSxHQUFJLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFBLEFBQUMsQ0FBQyxDQUFDO0FBQ3pFLGVBQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQztBQUN4QixlQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFDeEIsZUFBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDO09BQ3BDLENBQ0QsT0FBTSxDQUFDLEVBQUU7QUFDUCxZQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztPQUM5QjtLQUNGO0FBQ0QsUUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBQ1YsUUFBSSxjQUFjLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQztBQUN6QyxTQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtBQUN2QyxXQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsY0FBYyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtBQUM5QyxZQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssSUFBSSxFQUFFO0FBQzdILHdCQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDOUY7T0FDRjtLQUNGO0FBQ0QsUUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO0FBQ3ZCLFFBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7R0FDaEY7QUFDRCxpQkFBZSxFQUFBLDJCQUFHO0FBQ2hCLFNBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDM0IsVUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxLQUFLLEVBQUU7QUFDeEMsWUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztPQUNiO0tBQ0Y7R0FDRjtBQUNELGFBQVcsRUFBQSxxQkFBQyxNQUFNLEVBQUU7QUFDbEIsU0FBSyxJQUFJLE1BQU0sQ0FBQztBQUNoQixhQUFTLENBQUMsT0FBTyxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQztHQUNqQztBQUNELGNBQVksRUFBRSxzQkFBQSxJQUFJLEVBQUk7QUFDcEIsUUFBSSxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUNsQixVQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWixnQkFBVSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDL0IsVUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7S0FDdkM7R0FDRjtBQUNELGFBQVcsRUFBQSxxQkFBQyxNQUFNLEVBQUU7QUFDbEIsU0FBSyxJQUFJLE1BQU0sQ0FBQztBQUNoQixhQUFTLENBQUMsT0FBTyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsQ0FBQztHQUN0QztBQUNELGtCQUFnQixFQUFFLDBCQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUs7QUFDbkMsVUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ2QsU0FBSyxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUM7QUFDbEIsY0FBVSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDL0IsUUFBRyxLQUFLLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRTtBQUNwQixVQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztBQUM3QyxXQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDYixtQkFBYSxJQUFHLENBQUMsQ0FBQTtBQUNqQixnQkFBVSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDL0IsZ0JBQVUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEMsVUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNuRCxlQUFTLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztBQUN0RCxlQUFTLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUN0QyxlQUFTLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztLQUMzRDtHQUNGO0FBQ0QsS0FBRyxFQUFFLGFBQVUsQ0FBQyxFQUFFO0FBQ2hCLFFBQUksY0FBYyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDNUMsUUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLEVBQUU7QUFDL0QsVUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztBQUN6QyxVQUFJLFFBQVEsR0FBRyxHQUFHLENBQUM7QUFDbkIsY0FBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLFFBQVEsQ0FBQztBQUN2QyxZQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN2QixZQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDOztBQUVqRCxXQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDOUMsWUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUM5QixZQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsY0FBYyxDQUFDLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLEtBQUssQ0FBQyxLQUFLLEtBQUssSUFBSSxJQUFJLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLEdBQUcsR0FBRyxFQUFFO0FBQzdJLGdCQUFNLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxjQUFjLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDMUUsY0FBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDckQsY0FBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDMUM7T0FDRjtLQUNGO0dBQ0Y7Q0FDRixDQUFDOztBQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMiLCJmaWxlIjoiR2FtZS5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBleHBsb3Npb25zLCBtb25leSwgbW9uZXlUZXh0LCBzY29yZSwgc2NvcmVUZXh0LCByZXN0YXJ0R2FtZSwgd2F2ZU51bWJlcjsgXG5sZXQgbmV4dEZpcmUgPSBbXTtcbmxldCB3YXZlID0gMTtcbmxldCBlbmVtaWVzS2lsbGVkID0gMDtcbmxldCBwYXVzZWRHYW1lID0gZmFsc2U7XG5mb3IobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICBuZXh0RmlyZVtpXSA9IDA7XG59XG5QaGFzZXJHYW1lLkdhbWUgPSB7XG4gIGNyZWF0ZSgpIHtcbiAgICB0aGlzLmdhbWVXb3JsZCgpO1xuICB9LFxuICBnYW1lV29ybGQoKSB7XG4gICAgdGhpcy5zZXRTY2FsZSgpO1xuICAgIHRoaXMubWFrZUVsZW1lbnRzKCk7XG4gICAgdGhpcy5jcmVhdGVFbmVteVBsb3QodGhpcy5lbmVteVdhdmUpO1xuICAgIHRoaXMuc2NvcmVBbmRTdGF0cygpO1xuICAgIHRoaXMuY3JlYXRlR2FtZU11c2ljKCk7XG4gIH0sXG4gIG1ha2VFbGVtZW50cygpIHtcbiAgICBjb25zdCBtYXAgPSB0aGlzLmFkZC50aWxlbWFwKCdtYXAnKTtcbiAgICB0aGlzLmNyZWF0ZU1hcChtYXApO1xuICAgIHRoaXMuY3JlYXRlQnVsbGV0cygpO1xuICAgIHRoaXMuY3JlYXRlVHVycmV0cygpO1xuICAgIHRoaXMuY3JlYXRlRW5lbWllcygpO1xuICAgIG1hcC5jcmVhdGVMYXllcignVHJlZSBUb3BzIGFuZCBCcmlkZ2VzJykuc2NhbGUuc2V0KHRoaXMuc2NhbGUpO1xuICB9LFxuICBzZXRTY2FsZSgpIHtcbiAgICB0aGlzLnNjYWxlID0gMTtcbiAgICBpZiAod2luZG93LmlubmVyV2lkdGggPCAxMDI0IHx8IHdpbmRvdy5pbm5lckhlaWdodCA8IDc2OCkge1xuICAgICAgaWYgKCh3aW5kb3cuaW5uZXJXaWR0aC8xMDI0KSA+ICh3aW5kb3cuaW5uZXJIZWlnaHQvNzY4KSkge1xuICAgICAgICB0aGlzLnNjYWxlID0gd2luZG93LmlubmVySGVpZ2h0Lzc2ODtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2NhbGUgPSB3aW5kb3cuaW5uZXJXaWR0aC8xMDI0O1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgY3JlYXRlTWFwKG1hcCkge1xuICAgIC8vIEZpcnN0IHBhcmFtIDpuYW1lIG9mIHRpbGVzZXQgZnJvbSB0aWxlZDsgc2Vjb25kOiBnYW1lLmxvYWQuaW1hZ2VcbiAgICBtYXAuYWRkVGlsZXNldEltYWdlKCd0ZXJyYWluX2F0bGFzJywgJ3RlcnJhaW4nKTtcbiAgICBtYXAuYWRkVGlsZXNldEltYWdlKCd0dXJyZXRzMzInLCAndHVycmV0cycpO1xuICAgIGxldCBsYXllcnMgPSBbJ1JvYWQnLCAnR3Jhc3MnLCAnVHJlZSBiYXNlcyddO1xuICAgIGxheWVycy5mb3JFYWNoKGxheWVyID0+IG1hcC5jcmVhdGVMYXllcihsYXllcikuc2NhbGUuc2V0KHRoaXMuc2NhbGUpKTtcbiAgICB0aGlzLmJtZCA9IHRoaXMuYWRkLmJpdG1hcERhdGEoZ2FtZS53aWR0aCAqIHRoaXMuc2NhbGUsIGdhbWUuaGVpZ2h0ICogdGhpcy5zY2FsZSk7XG4gICAgdGhpcy5ibWQuYWRkVG9Xb3JsZCgpO1xuICB9LFxuICBjcmVhdGVCdWxsZXRzKCkge1xuICAgIHRoaXMuYnVsbGV0cyA9IGdhbWUuYWRkLmdyb3VwKCk7XG4gICAgbGV0IGJ1bGxldHMgPSB0aGlzLmJ1bGxldHM7XG4gICAgYnVsbGV0cy5zY2FsZS5zZXQodGhpcy5zY2FsZSk7XG4gICAgYnVsbGV0cy5lbmFibGVCb2R5ID0gdHJ1ZTtcbiAgICBidWxsZXRzLnBoeXNpY3NCb2R5VHlwZSA9IFBoYXNlci5QaHlzaWNzLkFSQ0FERTtcbiAgICBidWxsZXRzLmNyZWF0ZU11bHRpcGxlKDIwMDAsICdidWxsZXQxJyk7XG4gICAgYnVsbGV0cy5zZXRBbGwoJ2NoZWNrV29ybGRCb3VuZHMnLCB0cnVlKTtcbiAgICBidWxsZXRzLnNldEFsbCgnb3V0T2ZCb3VuZHNLaWxsJywgdHJ1ZSk7XG4gIH0sXG4gIGNyZWF0ZUVuZW1pZXMoKSB7XG4gICAgdGhpcy5lbmVtaWVzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgICBjb25zdCBlbmVtaWVzID0gdGhpcy5lbmVtaWVzO1xuICAgIGVuZW1pZXMuc2NhbGUuc2V0KHRoaXMuc2NhbGUpO1xuICAgIGVuZW1pZXMuZW5hYmxlQm9keSA9IHRydWU7XG4gICAgZW5lbWllcy5waHlzaWNzQm9keVR5cGUgPSBQaGFzZXIuUGh5c2ljcy5BUkNBREU7XG4gICAgLy8gdGhpcy5lbmVteVdhdmUgPSBbJ3RhbmsxJywgJ3RhbmsyJywgJ3RhbmszJywgJ3Rhbms0JywgJ3Rhbms1JywgJ3Rhbms2JywgJ3Rhbms3JywgJ3Rhbms4JywgJ3Rhbms5JywgJ3RhbmsxMCcsICd0YW5rMTEnXTtcbiAgICBjb25zdCB3YXZlTnVtYmVyID0gd2F2ZS0xO1xuICAgIGNvbnNvbGUubG9nKHdhdmVOdW1iZXIpO1xuICAgIHRoaXMuZW5lbXlXYXZlID0gdGhpcy53YXZlc09mV2F2ZXMoKVt3YXZlTnVtYmVyXTtcbiAgICBsZXQgZW5lbXlXYXZlID0gdGhpcy5lbmVteVdhdmU7XG4gICAgZW5lbXlXYXZlLmZvckVhY2goKGVuZW15U3RyaW5nLCBpKSA9PiB7XG4gICAgICBlbmVteVdhdmVbaV0gPSBlbmVtaWVzLmNyZWF0ZSgtMTYsIDExNiwgZW5lbXlTdHJpbmcpO1xuICAgICAgZW5lbXlXYXZlW2ldLmFuY2hvci5zZXQoMC41KTtcbiAgICAgIGVuZW15V2F2ZVtpXS5hbmltYXRpb25zLmFkZCgnZXhwbG9zaW9uJywgZmFsc2UpO1xuICAgICAgZW5lbXlXYXZlW2ldLmhlYWx0aCA9IHBhcnNlSW50KGVuZW15V2F2ZVtpXS5rZXkuc3BsaXQoJ2snKVsxXSk7XG4gICAgfSk7XG4gIH0sXG4gIHdhdmVzT2ZXYXZlcygpIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIFsndGFuazgnLCAndGFuazEwJywgJ3Rhbms4JywgJ3RhbmsxMScsICd0YW5rMTAnLCAndGFuazgnLCAndGFuazIzJywgJ3RhbmsxMCcsICd0YW5rOCcsICd0YW5rMTAnXSxcbiAgICAgICAgWyd0YW5rMTEnLCAndGFuazIzJywgJ3RhbmsxMScsICd0YW5rMjQnLCAndGFuazIzJywgJ3RhbmsxMScsICd0YW5rMjUnLCAndGFuazIzJywgJ3RhbmsxMScsICd0YW5rMjMnXSxcbiAgICAgICAgWyd0YW5rMjQnLCAndGFuazI1JywgJ3RhbmsyNCcsICd0YW5rMzAnLCAndGFuazI1JywgJ3RhbmsyNCcsICd0YW5rMzEnLCAndGFuazI1JywgJ3RhbmsyNCcsICd0YW5rMjUnXVxuICAgICAgXVxuICB9LFxuICBjcmVhdGVUdXJyZXRzKCkge1xuICAgIHRoaXMuZ3VucyA9IGdhbWUuYWRkLmdyb3VwKCk7XG4gICAgbGV0IGd1bnMgPSB0aGlzLmd1bnM7XG4gICAgZ3Vucy5zY2FsZS5zZXQodGhpcy5zY2FsZSk7XG4gICAgdGhpcy50dXJyZXRQb3NpdGlvbiA9IFsndHVycmV0MScsICd0dXJyZXQxJywgJ3R1cnJldDEnLCAndHVycmV0MScsICd0dXJyZXQxJywgJ3R1cnJldDEnLCAndHVycmV0MScsICd0dXJyZXQxJywgJ3R1cnJldDEnLCAndHVycmV0MSddXG4gICAgbGV0IHR1cnJldFBvc2l0aW9uID0gdGhpcy50dXJyZXRQb3NpdGlvbjtcbiAgICB0aGlzLmNvaW5Qb3NpdGlvbiA9IFsnY29pbicsICdjb2luJywgJ2NvaW4nLCAnY29pbicsICdjb2luJywgJ2NvaW4nLCAnY29pbicsICdjb2luJywgJ2NvaW4nLCAnY29pbiddXG4gICAgbGV0IGNvaW5Qb3NpdGlvbiA9IHRoaXMuY29pblBvc2l0aW9uO1xuICAgIHRoaXMudHVycmV0U3BvdHMgPSB7XG4gICAgICAneCcgOiBbMzUyLCA4MDAsIDI1NiwgNDQ4LCA5NiwgMzIwLCAxMjgsIDM1NCwgODMyLCA4NjRdLFxuICAgICAgJ3knIDogWzMyLCA5NiwgMjU2LCAyNTYsIDMyMCwgNDgwLCA2NDAsIDcwNCwgMzg0LCA1NDRdXG4gICAgfVxuICAgIGxldCB0dXJyZXRTcG90cyA9IHRoaXMudHVycmV0U3BvdHM7XG4gICAgbGV0IGNyZWF0ZVR1cnJldCA9IHRoaXMuY3JlYXRlVHVycmV0O1xuICAgIGxldCBzY2FsZSA9IHRoaXMuc2NhbGU7XG4gICAgdHVycmV0UG9zaXRpb24uZm9yRWFjaCgodHVycmV0LCBpKSA9PiB7XG4gICAgICB0dXJyZXRQb3NpdGlvbltpXSA9IGd1bnMuY3JlYXRlKHR1cnJldFNwb3RzLnhbaV0sIHR1cnJldFNwb3RzLnlbaV0sIHR1cnJldFBvc2l0aW9uW2ldKTtcbiAgICAgIHR1cnJldFBvc2l0aW9uW2ldLmFuY2hvci5zZXQoMC41KTtcbiAgICAgIGNvaW5Qb3NpdGlvbltpXSA9IGdhbWUuYWRkLmJ1dHRvbih0dXJyZXRTcG90cy54W2ldICogc2NhbGUsIHR1cnJldFNwb3RzLnlbaV0gKiBzY2FsZSwgY29pblBvc2l0aW9uW2ldLCBjcmVhdGVUdXJyZXQpO1xuICAgICAgY29pblBvc2l0aW9uW2ldLmFuY2hvci5zZXQoMC41KTtcbiAgICB9KTtcbiAgICBleHBsb3Npb25zID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgICBleHBsb3Npb25zLnNjYWxlLnNldCh0aGlzLnNjYWxlKTtcbiAgICBleHBsb3Npb25zLmNyZWF0ZU11bHRpcGxlKDEwMCwgJ2V4cGxvc2lvbicpO1xuICB9LFxuICBjcmVhdGVTY29yZSgpIHtcbiAgICBzY29yZSA9IDA7XG4gICAgc2NvcmVUZXh0ID0gZ2FtZS5hZGQudGV4dCg4MjAgKiB0aGlzLnNjYWxlLCAxMCAqIHRoaXMuc2NhbGUsICdTY29yZTogJyArIHNjb3JlKTtcbiAgfSxcbiAgY3JlYXRlTW9uZXkoKSB7XG4gICAgbW9uZXkgPSA0MDtcbiAgICBtb25leVRleHQgPSBnYW1lLmFkZC50ZXh0KDQxMiAqIHRoaXMuc2NhbGUsIDEwICogdGhpcy5zY2FsZSwgXCIkIFwiICsgbW9uZXkpO1xuICB9LFxuICBzY29yZUFuZFN0YXRzKCkge1xuICAgIHRoaXMuY3JlYXRlU2NvcmUoKTtcbiAgICB0aGlzLmNyZWF0ZU1vbmV5KCk7XG4gICAgd2F2ZU51bWJlciA9IGdhbWUuYWRkLnRleHQoMzAsIDEwLCAnV2F2ZSAnICsgd2F2ZSk7XG4gIH0sXG4gIGNyZWF0ZUdhbWVNdXNpYygpIHtcbiAgICB0aGlzLmJhY2tncm91bmRNdXNpYyA9IGdhbWUuYWRkLmF1ZGlvKCdiYWNrZ3JvdW5kTXVzaWMnLCB0cnVlKTtcbiAgICB0aGlzLmJhY2tncm91bmRNdXNpYy5wbGF5KCcnLCAwLCAwLjIsIHRydWUpO1xuICB9LFxuICBjcmVhdGVFbmVteVBsb3QoZW5lbWllcykge1xuICAgIHRoaXMucGF0aCA9IFtdO1xuICAgIGxldCBpeCA9IDA7XG4gICAgY29uc3QgeCA9IDEgLyAoZ2FtZS53aWR0aCArIChlbmVtaWVzLmxlbmd0aCAtIDEpICogMTAwKTtcbiAgICB0aGlzLnBvaW50cz0ge1xuICAgICAgJ3gnOiBbLTQ2NiwgLTQxNiwgLTM2NiwgLTMxNiwgLTI2NiwgLTIxNiwgLTE1NiwgLTU2LCAtMTYsIDEwMCwgMjAwLCAzMDAsIDQwMCwgNTAwLCA2MDAsIDcwMCwgNzQwLCA2NzUsIDYwMCwgNTAwLCA0MDAsIDMwMCwgMjA1LCAxODAsIDE5MCwgMjkwLCAzOTAsIDQ5MCwgNTkwLCA2OTAsIDc5MCwgODUwLCA4NjAsIDg2MCwgODYwLCA4NjAsIDg2MCwgODYwLCA4NjAsIDg2MCwgODYwLCA4NjBdLFxuICAgICAgJ3knOiBbMTMwLCAxMzAsIDEzMCwgMTMwLCAxMzAsIDEzMCwgMTMwLCAxMzAsIDEzMCwgMTMwLCAxMzAsIDEzMCwgMTMwLCAxNDUsIDE2MCwgMTgwLCAyNTAsIDMxMCwgMzQwLCAzNTAsIDM1MCwgMzY1LCA0MDAsIDQ3NSwgNTUwLCA1OTAsIDYxMCwgNjIzLCA2MzAsIDYzOCwgNjUwLCA3MjAsIDgwMCwgODUwLCA5MDAsIDk1MCwgMTAwMCwgMTA1MCwgMTEwMCwgMTE1MCwgMTIwMCwgMTI1MF1cbiAgICB9O1xuICAgIHRoaXMucGkgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IDE7IGkgKz0geCkge1xuICAgICAgY29uc3QgcHggPSB0aGlzLm1hdGguY2F0bXVsbFJvbUludGVycG9sYXRpb24odGhpcy5wb2ludHMueCwgaSk7XG4gICAgICBjb25zdCBweSA9IHRoaXMubWF0aC5jYXRtdWxsUm9tSW50ZXJwb2xhdGlvbih0aGlzLnBvaW50cy55LCBpKTtcbiAgICAgIC8vVGhpcyBkcmF3cyB0aGUgcGF0aCBvbnRvIHRoZSBzY3JlZW4gdG8gZWRpdCB0aGUgcGF0aFxuICAgICAgLy8gdGhpcy5ibWQucmVjdChweCwgcHksIDEsIDEsICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDEpJyk7XG4gICAgICBjb25zdCBub2RlID0ge3g6IHB4LCB5OiBweSwgYW5nbGU6IDB9O1xuICAgICAgaWYgKGl4ID4gMCkge1xuICAgICAgICBub2RlLmFuZ2xlID0gdGhpcy5tYXRoLmFuZ2xlQmV0d2VlblBvaW50cyh0aGlzLnBhdGhbaXggLSAxXSwgbm9kZSk7XG4gICAgICB9XG4gICAgICB0aGlzLnBhdGgucHVzaChub2RlKTtcbiAgICAgIGl4Kys7XG4gICAgfVxuICAgIC8vIFRoaXMgZHJhd3MgcmVjdGFuZ2xlcyBvbnRvIHRoZSBwYXRoIHdoZXJlIHRoZSBub2RlcyBhcmUgbG9jYXRlZFxuICAgIC8vIGZvciAodmFyIHAgPSAwOyBwIDwgdGhpcy5wb2ludHMueC5sZW5ndGg7IHArKykge1xuICAgIC8vICAgdGhpcy5ibWQucmVjdCh0aGlzLnBvaW50cy54W3BdLTMsIHRoaXMucG9pbnRzLnlbcF0tMywgNiwgNiwgJ3JnYmEoMjU1LCAwLCAwLCAxKScpO1xuICAgIC8vIH1cbiAgfSxcbiAgdXBkYXRlKCkge1xuICAgIGlmICh3YXZlIDwgMykge1xuICAgICAgdGhpcy5zZW5kRW5lbXlXYXZlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3RhcnRUYW5rTWlzc2lvbih0aGlzLmVuZW15V2F2ZSk7XG4gICAgICBpZiAoZW5lbWllc0tpbGxlZCA+PSB0aGlzLmVuZW15V2F2ZS5sZW5ndGggKiB3YXZlKSB7XG4gICAgICAgIGVuZW1pZXNLaWxsZWQgPSAwO1xuICAgICAgICBnYW1lLnN0YXRlLnN0YXJ0KCdHYW1lV29uJyk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBzZW5kRW5lbXlXYXZlKCkge1xuICAgIHRoaXMuc3RhcnRUYW5rTWlzc2lvbih0aGlzLmVuZW15V2F2ZSk7XG4gICAgaWYgKGVuZW1pZXNLaWxsZWQgPj0gdGhpcy5lbmVteVdhdmUubGVuZ3RoICogd2F2ZSkge1xuICAgICAgLy8gbWFwLmNyZWF0ZUxheWVyKCdUcmVlIFRvcHMgYW5kIEJyaWRnZXMnKS5zY2FsZS5zZXQodGhpcy5zY2FsZSk7XG4gICAgICBQaGFzZXJHYW1lLkdhbWUuY3JlYXRlRW5lbXlQbG90KFBoYXNlckdhbWUuR2FtZS5lbmVteVdhdmUpO1xuICAgICAgd2F2ZSsrO1xuICAgICAgd2F2ZU51bWJlci5zZXRUZXh0KCdXYXZlICcgKyB3YXZlKTtcbiAgICAgIFBoYXNlckdhbWUuR2FtZS5jcmVhdGVFbmVtaWVzKCk7XG4gICAgfVxuICB9LFxuICBzdGFydFRhbmtNaXNzaW9uKGVuZW1pZXMpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVuZW1pZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMucGF0aFt0aGlzLnBpICsgKChlbmVtaWVzLmxlbmd0aCAtIDEpICogNDAgLSBpICogNDApXTtcbiAgICAgICAgZW5lbWllc1tpXS54ID0gb2Zmc2V0Lng7XG4gICAgICAgIGVuZW1pZXNbaV0ueSA9IG9mZnNldC55O1xuICAgICAgICBlbmVtaWVzW2ldLnJvdGF0aW9uID0gb2Zmc2V0LmFuZ2xlO1xuICAgICAgfVxuICAgICAgY2F0Y2goZSkge1xuICAgICAgICBnYW1lLnN0YXRlLnN0YXJ0KCdHYW1lTG9zdCcpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnBpKys7XG4gICAgbGV0IHR1cnJldFBvc2l0aW9uID0gdGhpcy50dXJyZXRQb3NpdGlvbjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVuZW1pZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdHVycmV0UG9zaXRpb24ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgaWYgKHRoaXMucGh5c2ljcy5hcmNhZGUuZGlzdGFuY2VUb1hZKGVuZW1pZXNbaV0sIHR1cnJldFBvc2l0aW9uW2pdLngsIHR1cnJldFBvc2l0aW9uW2pdLnkpIDwgMjAwICYmIGVuZW1pZXNbaV0uYWxpdmUgPT09IHRydWUpIHtcbiAgICAgICAgICB0dXJyZXRQb3NpdGlvbltqXS5yb3RhdGlvbiA9IGdhbWUucGh5c2ljcy5hcmNhZGUuYW5nbGVCZXR3ZWVuKHR1cnJldFBvc2l0aW9uW2pdLCBlbmVtaWVzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnVwZGF0ZVR1cnJldEFpbSgpO1xuICAgIGdhbWUucGh5c2ljcy5hcmNhZGUub3ZlcmxhcCh0aGlzLmJ1bGxldHMsIHRoaXMuZW5lbWllcywgdGhpcy5jb2xsaXNpb25IYW5kbGVyKTtcbiAgfSxcbiAgdXBkYXRlVHVycmV0QWltKCkge1xuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgMTA7IHkrKykge1xuICAgICAgaWYgKHRoaXMuY29pblBvc2l0aW9uW3ldLmFsaXZlID09PSBmYWxzZSkge1xuICAgICAgICB0aGlzLmFpbSh5KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHVwZGF0ZU1vbmV5KGFtb3VudCkge1xuICAgIG1vbmV5IC09IGFtb3VudDtcbiAgICBtb25leVRleHQuc2V0VGV4dCgnJCAnICsgbW9uZXkpO1xuICB9LFxuICBjcmVhdGVUdXJyZXQ6IGNvaW4gPT4ge1xuICAgIGlmIChtb25leSAtIDggPj0gMCkge1xuICAgICAgY29pbi5raWxsKCk7XG4gICAgICBQaGFzZXJHYW1lLkdhbWUudXBkYXRlTW9uZXkoOCk7XG4gICAgICBnYW1lLmFkZC5hdWRpbygnY2FzaFJlZ2lzdGVyJykucGxheSgpO1xuICAgIH1cbiAgfSxcbiAgdXBkYXRlU2NvcmUocG9pbnRzKSB7XG4gICAgc2NvcmUgKz0gcG9pbnRzO1xuICAgIHNjb3JlVGV4dC5zZXRUZXh0KCdTY29yZTogJyArIHNjb3JlKTsgXG4gIH0sXG4gIGNvbGxpc2lvbkhhbmRsZXI6IChidWxsZXQsIGVuZW15KSA9PiB7XG4gICAgYnVsbGV0LmtpbGwoKTtcbiAgICBlbmVteS5oZWFsdGggLT0gMTtcbiAgICBQaGFzZXJHYW1lLkdhbWUudXBkYXRlU2NvcmUoMSk7XG4gICAgaWYoZW5lbXkuaGVhbHRoIDw9IDApIHtcbiAgICAgIGdhbWUuYWRkLmF1ZGlvKCdleHBsb3Npb24nKS5wbGF5KCcnLCAwLCAwLjQpO1xuICAgICAgZW5lbXkua2lsbCgpO1xuICAgICAgZW5lbWllc0tpbGxlZCArPTFcbiAgICAgIFBoYXNlckdhbWUuR2FtZS51cGRhdGVTY29yZSg1KTtcbiAgICAgIFBoYXNlckdhbWUuR2FtZS51cGRhdGVNb25leSgtNSk7XG4gICAgICBjb25zdCBleHBsb3Npb24gPSBleHBsb3Npb25zLmdldEZpcnN0RXhpc3RzKGZhbHNlKTtcbiAgICAgIGV4cGxvc2lvbi5yZXNldChlbmVteS5ib2R5LnggLSA3MCwgZW5lbXkuYm9keS55IC0gNzApO1xuICAgICAgZXhwbG9zaW9uLmFuaW1hdGlvbnMuYWRkKCdleHBsb3Npb24nKTtcbiAgICAgIGV4cGxvc2lvbi5hbmltYXRpb25zLnBsYXkoJ2V4cGxvc2lvbicsIG51bGwsIGZhbHNlLCB0cnVlKTtcbiAgICB9XG4gIH0sXG4gIGFpbTogZnVuY3Rpb24gKHgpIHtcbiAgICBsZXQgdHVycmV0UG9zaXRpb24gPSB0aGlzLnR1cnJldFBvc2l0aW9uW3hdO1xuICAgIGlmIChnYW1lLnRpbWUubm93ID4gbmV4dEZpcmVbeF0gJiYgdGhpcy5idWxsZXRzLmNvdW50RGVhZCgpID4gMCkge1xuICAgICAgbGV0IGJ1bGxldCA9IHRoaXMuYnVsbGV0cy5nZXRGaXJzdERlYWQoKTtcbiAgICAgIGxldCBmaXJlUmF0ZSA9IDMwMDtcbiAgICAgIG5leHRGaXJlW3hdID0gZ2FtZS50aW1lLm5vdyArIGZpcmVSYXRlO1xuICAgICAgYnVsbGV0LmFuY2hvci5zZXQoMC41KTtcbiAgICAgIGJ1bGxldC5yZXNldCh0dXJyZXRQb3NpdGlvbi54LCB0dXJyZXRQb3NpdGlvbi55KTtcbiAgICAgIC8vIFRyeSBkZWNyaW1lbnRpbmcgdGhlIGZ1bmN0aW9uIHRvIGhhdmUgaXQgYWltIGF0IHRoZSBmaXJzdCB0dXJyZXRcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5lbmVteVdhdmUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IGVuZW15ID0gdGhpcy5lbmVteVdhdmVbaV07XG4gICAgICAgIGlmICh0aGlzLnBoeXNpY3MuYXJjYWRlLmRpc3RhbmNlVG9YWShlbmVteSwgdHVycmV0UG9zaXRpb24ueCwgdHVycmV0UG9zaXRpb24ueSkgPCAyMDAgJiYgZW5lbXkuYWxpdmUgPT09IHRydWUgJiYgZW5lbXkueCA+IDAgJiYgZW5lbXkueSA8IDc2OCkge1xuICAgICAgICAgIGJ1bGxldC5yb3RhdGlvbiA9IGdhbWUucGh5c2ljcy5hcmNhZGUuYW5nbGVCZXR3ZWVuKHR1cnJldFBvc2l0aW9uLCBlbmVteSk7XG4gICAgICAgICAgZ2FtZS5waHlzaWNzLmFyY2FkZS5tb3ZlVG9PYmplY3QoYnVsbGV0LCBlbmVteSwgMzAwKTtcbiAgICAgICAgICBnYW1lLmFkZC5hdWRpbygnc2hvdCcpLnBsYXkoJycsIDAsIDAuMDUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5nYW1lLnN0YXRlLmFkZCgnR2FtZScsIFBoYXNlckdhbWUuR2FtZSk7Il19
