'use strict';

var explosions, score, waveNumber, startingMoney, startingWaveNumber, startingScore;

var fireRate = 300;
var nextFire = [];
for (var i = 0; i < 10; i++) {
  nextFire[i] = 0;
}
var money = 40;

PhaserGame.Game = function (game) {};

PhaserGame.Game.prototype = {
  create: function create() {
    var $ = this;

    ///////////////////////////////////////
    //      Map and Layers Creation      //
    ///////////////////////////////////////

    var map = this.add.tilemap('map');

    //First param :name of tileset from tiled; second: game.load.image
    map.addTilesetImage('terrain_atlas', 'terrain');
    map.addTilesetImage('turrets32', 'turrets');

    $.road = map.createLayer('Road');
    $.grass = map.createLayer('Grass');
    $.trees = map.createLayer('Tree bases');

    ////////////////////////////////////////////////////////
    //      Enemy sprite and travel path information      //
    ////////////////////////////////////////////////////////

    $.enemies = game.add.group();
    $.enemies.hp = 3;
    $.enemies.enableBody = true;
    $.enemies.physicsBodyType = Phaser.Physics.ARCADE;

    $.enemyWave = ['tank1', 'tank2', 'tank3', 'tank4', 'tank5', 'tank6', 'tank7', 'tank8', 'tank9'];

    for (var i = 0; i < $.enemyWave.length; i++) {
      $.enemyWave[i] = $.enemies.create(-16, 116, $.enemyWave[i]);
      $.enemyWave[i].anchor.set(0.5);
      $.enemyWave[i].animations.add('explosion', false);
      $.enemyWave[i].health = 10;
    }

    ///////////////////////
    //      Bullets      //
    ///////////////////////

    $.bullets = game.add.group();

    $.bullets.enableBody = true;
    $.bullets.physicsBodyType = Phaser.Physics.ARCADE;
    $.bullets.createMultiple(500, 'bullet1');
    $.bullets.setAll('checkWorldBounds', true);
    $.bullets.setAll('outOfBoundsKill', true);

    ///////////////////////////////
    //     Turrets and Coins     //
    ///////////////////////////////

    $.guns = game.add.group();

    $.turretPosition = ['turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1'];
    $.coinPosition = ['coin', 'coin', 'coin', 'coin', 'coin', 'coin', 'coin', 'coin', 'coin', 'coin'];

    $.turretSpots = {
      'x': [352, 800, 256, 448, 96, 320, 128, 354, 832, 864],
      'y': [32, 96, 256, 256, 320, 480, 640, 704, 384, 544]
    };

    for (var i = 0; i < this.turretPosition.length; i++) {
      $.turretPosition[i] = $.guns.create($.turretSpots.x[i], $.turretSpots.y[i], $.turretPosition[i]);
      $.turretPosition[i].anchor.set(0.5);
      $.coinPosition[i] = game.add.button($.turretSpots.x[i], $.turretSpots.y[i], $.coinPosition[i], $.createTurret);
      $.coinPosition[i].anchor.set(0.5);
    }

    /////////////////////////////////
    //     Explosions and fire     //
    /////////////////////////////////

    explosions = game.add.group();
    explosions.createMultiple(20, 'explosion');

    ///////////////////////////////////////////////
    //      Add Bit Mad Data and Last Layer      //
    ///////////////////////////////////////////////

    $.bmd = $.add.bitmapData(game.width, game.height);
    $.bmd.addToWorld();
    $.plot();

    $.bridges = map.createLayer('Tree Tops and Bridges');

    ////////////////////////////////////////////////////
    //     Texts for Score, Money, and Wave Count     //
    ////////////////////////////////////////////////////

    startingMoney = 40;
    startingScore = 0;
    startingWaveNumber = 1;
    score = game.add.text(820, 10, 'Score:');
    money = game.add.text(412, 10, '$ 40');
    waveNumber = game.add.text(30, 10, 'Wave 1');

    /////////////////////////////////////
    //     Music and Sound Effects     //
    /////////////////////////////////////

    $.backgroundMusic = game.add.audio('backgroundMusic', true);
    $.backgroundMusic.play();
  },

  plot: function plot() {
    var $ = this;

    ////////////////////////////////////////////////////
    //      Path plot info for the enemy sprites      //
    ////////////////////////////////////////////////////

    $.path = [];
    var ix = 0;
    var x = 1 / (game.width + ($.enemyWave.length - 1) * 100);

    $.points = {
      'x': [-466, -416, -366, -316, -266, -216, -156, -56, -16, 100, 200, 300, 400, 500, 600, 700, 740, 675, 600, 500, 400, 300, 205, 180, 190, 290, 390, 490, 590, 690, 790, 850, 860, 860, 860, 860, 860, 860, 860, 860, 860, 860],
      'y': [130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 145, 160, 180, 250, 310, 340, 350, 350, 365, 400, 475, 550, 590, 610, 623, 630, 638, 650, 720, 800, 850, 900, 950, 1000, 1050, 1100, 1150, 1200, 1250]
    };

    $.pi = 0;

    for (var i = 0; i <= 1; i += x) {

      var px = $.math.catmullRomInterpolation($.points.x, i);
      var py = $.math.catmullRomInterpolation($.points.y, i);

      //This draws the path onto the screen to edit the path
      // this.bmd.rect(px, py, 1, 1, 'rgba(255, 255, 255, 1)');

      var node = { x: px, y: py, angle: 0 };
      if (ix > 0) {
        node.angle = $.math.angleBetweenPoints($.path[ix - 1], node);
      }
      $.path.push(node);
      ix++;
    }

    //This draws rectangles onto the path where the nodes are located
    // for (var p = 0; p < this.points.x.length; p++) {
    //   this.bmd.rect(this.points.x[p]-3, this.points.y[p]-3, 6, 6, 'rgba(255, 0, 0, 1)');
    // }
  },

  update: function update() {
    var $ = this;

    //////////////////////////////////////////////
    //     Places enemy tanks into the wave     //
    //////////////////////////////////////////////

    for (var i = 0; i < $.enemyWave.length; i++) {
      var offset = $.path[$.pi + (($.enemyWave.length - 1) * 40 - i * 40)];
      if ($.enemyWave[8].x !== 860) {
        $.enemyWave[i].x = offset.x;
        $.enemyWave[i].y = offset.y;
        $.enemyWave[i].rotation = offset.angle;
      }
    };

    $.pi++;
    // if (this.pi >= this.path.length) {
    //   this.pi = 0;
    // }

    for (var i = 0; i < $.enemyWave.length; i++) {
      for (var j = 0; j < $.turretPosition.length; j++) {
        if ($.physics.arcade.distanceToXY($.enemyWave[i], $.turretPosition[j].x, $.turretPosition[j].y) < 200 && $.enemyWave[i].alive === true) {
          $.turretPosition[j].rotation = game.physics.arcade.angleBetween($.turretPosition[j], $.enemyWave[i]);
        }
      }
    }

    ///////////////////////////////////////
    //     Coin kill for turret fire     //
    ///////////////////////////////////////
    for (var y = 0; y < 10; y++) {
      if ($.coinPosition[y].alive === false) {
        $.aim(y);
      }
    }

    game.physics.arcade.overlap($.bullets, $.enemies, $.collisionHandler);
  },

  playCashRegister: function playCashRegister() {
    console.log('works');
  },

  createTurret: function createTurret(coin) {
    coin.kill();
    this.cashRegister = game.add.audio('cashRegister');
    this.cashRegister.play();
  },

  collisionHandler: function collisionHandler(bullet, enemy) {
    bullet.kill();
    // console.log(enemy.health);
    enemy.health -= 1;
    if (enemy.health <= 0) {
      this.explosionSound = game.add.audio('explosion');
      this.explosionSound.play();
      enemy.kill();
      var explosion = explosions.getFirstExists(false);
      explosion.reset(enemy.body.x - 70, enemy.body.y - 70);
      explosion.animations.add('explosion');
      explosion.animations.play('explosion');
    }
  },
  aim: function aim(x) {
    var turr = this.turretPosition[x];
    if (game.time.now > nextFire[x] && this.bullets.countDead() > 0) {
      nextFire[x] = game.time.now + fireRate;
      var bullet = this.bullets.getFirstDead();
      bullet.anchor.set(0.5);
      bullet.reset(turr.x, turr.y);
      //Try decrimenting the function to have it aim at the first turret
      for (var i = 0; i < this.enemyWave.length; i++) {
        var enem = this.enemyWave[i];
        if (this.physics.arcade.distanceToXY(enem, turr.x, turr.y) < 200 && enem.alive === true && enem.x > 0 && enem.y < 768) {
          bullet.rotation = game.physics.arcade.angleBetween(turr, enem);
          game.physics.arcade.moveToObject(bullet, enem, 300);
          var shot = game.add.audio('shot');
          shot.play();
        }
      }
    }
  },
  render: function render() {}

};

game.state.add('Game', PhaserGame.Game);

game.state.start('Boot');

// this.weapons = [];

// game.debug.text('Active Bullets: ' + this.bullets.countLiving() + ' / ' + this.bullets.countDead() + ' / ' + this.bullets.total, 32, 32);
// game.debug.text(game.time.now + ' / ' + nextFire, 32, 64)
//# sourceMappingURL=data:application/json;base64,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QUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUM7QUFDOU4sU0FBRyxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUM7S0FDOU4sQ0FBQzs7QUFFRixLQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQzs7QUFFVCxTQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFB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LElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxJQUFJLElBQUksSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLEVBQUU7QUFDckgsZ0JBQU0sQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztBQUMvRCxjQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztBQUNwRCxjQUFJLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNsQyxjQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDYjtPQUNGO0tBQ0Y7R0FDRjtBQUNELFFBQU0sRUFBRSxrQkFBWSxFQUtuQjs7Q0FFRixDQUFDOztBQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7O0FBRXhDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDIiwiZmlsZSI6InNyYy9qcy9HYW1lLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGV4cGxvc2lvbnMsIHNjb3JlLCB3YXZlTnVtYmVyLCBzdGFydGluZ01vbmV5LCBzdGFydGluZ1dhdmVOdW1iZXIsIHN0YXJ0aW5nU2NvcmU7XG5cbnZhciBmaXJlUmF0ZSA9IDMwMDtcbnZhciBuZXh0RmlyZSA9IFtdO1xuZm9yKHZhciBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgbmV4dEZpcmVbaV0gPSAwO1xufVxudmFyIG1vbmV5ID0gNDA7XG5cblBoYXNlckdhbWUuR2FtZSA9IGZ1bmN0aW9uIChnYW1lKSB7XG4gIC8vIHRoaXMud2VhcG9ucyA9IFtdO1xufVxuXG5QaGFzZXJHYW1lLkdhbWUucHJvdG90eXBlID0ge1xuICAgIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyICQgPSB0aGlzO1xuXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gICAgICBNYXAgYW5kIExheWVycyBDcmVhdGlvbiAgICAgIC8vXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICB2YXIgbWFwID0gdGhpcy5hZGQudGlsZW1hcCgnbWFwJyk7XG5cbiAgICAgIC8vRmlyc3QgcGFyYW0gOm5hbWUgb2YgdGlsZXNldCBmcm9tIHRpbGVkOyBzZWNvbmQ6IGdhbWUubG9hZC5pbWFnZVxuICAgIG1hcC5hZGRUaWxlc2V0SW1hZ2UoJ3RlcnJhaW5fYXRsYXMnLCAndGVycmFpbicpO1xuICAgIG1hcC5hZGRUaWxlc2V0SW1hZ2UoJ3R1cnJldHMzMicsICd0dXJyZXRzJyk7XG5cbiAgICAkLnJvYWQgPSBtYXAuY3JlYXRlTGF5ZXIoJ1JvYWQnKTtcbiAgICAkLmdyYXNzID0gbWFwLmNyZWF0ZUxheWVyKCdHcmFzcycpO1xuICAgICQudHJlZXMgPSBtYXAuY3JlYXRlTGF5ZXIoJ1RyZWUgYmFzZXMnKTtcblxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gICAgICBFbmVteSBzcHJpdGUgYW5kIHRyYXZlbCBwYXRoIGluZm9ybWF0aW9uICAgICAgLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgJC5lbmVtaWVzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgICAkLmVuZW1pZXMuaHAgPSAzO1xuICAgICQuZW5lbWllcy5lbmFibGVCb2R5ID0gdHJ1ZTtcbiAgICAkLmVuZW1pZXMucGh5c2ljc0JvZHlUeXBlID0gUGhhc2VyLlBoeXNpY3MuQVJDQURFO1xuXG4gICAgJC5lbmVteVdhdmUgPSBbJ3RhbmsxJywgJ3RhbmsyJywgJ3RhbmszJywgJ3Rhbms0JywgJ3Rhbms1JywgJ3Rhbms2JywgJ3Rhbms3JywgJ3Rhbms4JywgJ3Rhbms5J107XG5cblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJC5lbmVteVdhdmUubGVuZ3RoOyBpKyspIHtcbiAgICAgICQuZW5lbXlXYXZlW2ldID0gJC5lbmVtaWVzLmNyZWF0ZSgtMTYsIDExNiwgJC5lbmVteVdhdmVbaV0pO1xuICAgICAgJC5lbmVteVdhdmVbaV0uYW5jaG9yLnNldCgwLjUpO1xuICAgICAgJC5lbmVteVdhdmVbaV0uYW5pbWF0aW9ucy5hZGQoJ2V4cGxvc2lvbicsIGZhbHNlKTtcbiAgICAgICQuZW5lbXlXYXZlW2ldLmhlYWx0aCA9IDEwO1xuICAgIH1cblxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gICAgICBCdWxsZXRzICAgICAgLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgJC5idWxsZXRzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcblxuICAgICQuYnVsbGV0cy5lbmFibGVCb2R5ID0gdHJ1ZTtcbiAgICAkLmJ1bGxldHMucGh5c2ljc0JvZHlUeXBlID0gUGhhc2VyLlBoeXNpY3MuQVJDQURFO1xuICAgICQuYnVsbGV0cy5jcmVhdGVNdWx0aXBsZSg1MDAsICdidWxsZXQxJyk7XG4gICAgJC5idWxsZXRzLnNldEFsbCgnY2hlY2tXb3JsZEJvdW5kcycsIHRydWUpO1xuICAgICQuYnVsbGV0cy5zZXRBbGwoJ291dE9mQm91bmRzS2lsbCcsIHRydWUpO1xuXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vICAgICBUdXJyZXRzIGFuZCBDb2lucyAgICAgLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAkLmd1bnMgPSBnYW1lLmFkZC5ncm91cCgpO1xuXG4gICAgJC50dXJyZXRQb3NpdGlvbiA9IFsndHVycmV0MScsICd0dXJyZXQxJywgJ3R1cnJldDEnLCAndHVycmV0MScsICd0dXJyZXQxJywgJ3R1cnJldDEnLCAndHVycmV0MScsICd0dXJyZXQxJywgJ3R1cnJldDEnLCAndHVycmV0MSddXG4gICAgJC5jb2luUG9zaXRpb24gPSBbJ2NvaW4nLCAnY29pbicsICdjb2luJywgJ2NvaW4nLCAnY29pbicsICdjb2luJywgJ2NvaW4nLCAnY29pbicsICdjb2luJywgJ2NvaW4nXVxuXG5cbiAgICAkLnR1cnJldFNwb3RzID0ge1xuICAgICAgJ3gnIDogWzM1MiwgODAwLCAyNTYsIDQ0OCwgOTYsIDMyMCwgMTI4LCAzNTQsIDgzMiwgODY0XSxcbiAgICAgICd5JyA6IFszMiwgOTYsIDI1NiwgMjU2LCAzMjAsIDQ4MCwgNjQwLCA3MDQsIDM4NCwgNTQ0XVxuICAgIH1cblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50dXJyZXRQb3NpdGlvbi5sZW5ndGg7IGkrKykge1xuICAgICAgJC50dXJyZXRQb3NpdGlvbltpXSA9ICQuZ3Vucy5jcmVhdGUoJC50dXJyZXRTcG90cy54W2ldLCAkLnR1cnJldFNwb3RzLnlbaV0sICQudHVycmV0UG9zaXRpb25baV0pO1xuICAgICAgJC50dXJyZXRQb3NpdGlvbltpXS5hbmNob3Iuc2V0KDAuNSk7XG4gICAgICAkLmNvaW5Qb3NpdGlvbltpXSA9IGdhbWUuYWRkLmJ1dHRvbigkLnR1cnJldFNwb3RzLnhbaV0sICQudHVycmV0U3BvdHMueVtpXSwgJC5jb2luUG9zaXRpb25baV0sICQuY3JlYXRlVHVycmV0KTtcbiAgICAgICQuY29pblBvc2l0aW9uW2ldLmFuY2hvci5zZXQoMC41KTtcbiAgICB9XG5cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyAgICAgRXhwbG9zaW9ucyBhbmQgZmlyZSAgICAgLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgIGV4cGxvc2lvbnMgPSBnYW1lLmFkZC5ncm91cCgpO1xuICAgIGV4cGxvc2lvbnMuY3JlYXRlTXVsdGlwbGUoMjAsICdleHBsb3Npb24nKTtcblxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gICAgICBBZGQgQml0IE1hZCBEYXRhIGFuZCBMYXN0IExheWVyICAgICAgLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgJC5ibWQgPSAkLmFkZC5iaXRtYXBEYXRhKGdhbWUud2lkdGgsIGdhbWUuaGVpZ2h0KTtcbiAgICAkLmJtZC5hZGRUb1dvcmxkKCk7XG4gICAgJC5wbG90KCk7XG5cbiAgICAkLmJyaWRnZXMgPSBtYXAuY3JlYXRlTGF5ZXIoJ1RyZWUgVG9wcyBhbmQgQnJpZGdlcycpO1xuXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vICAgICBUZXh0cyBmb3IgU2NvcmUsIE1vbmV5LCBhbmQgV2F2ZSBDb3VudCAgICAgLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICBzdGFydGluZ01vbmV5ID0gNDA7XG4gICAgc3RhcnRpbmdTY29yZSA9IDA7XG4gICAgc3RhcnRpbmdXYXZlTnVtYmVyID0gMTtcbiAgICBzY29yZSA9IGdhbWUuYWRkLnRleHQoODIwLCAxMCwgJ1Njb3JlOicpO1xuICAgIG1vbmV5ID0gZ2FtZS5hZGQudGV4dCg0MTIsIDEwLCBcIiQgNDBcIik7XG4gICAgd2F2ZU51bWJlciA9IGdhbWUuYWRkLnRleHQoMzAsIDEwLCAnV2F2ZSAxJyk7XG5cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gICAgIE11c2ljIGFuZCBTb3VuZCBFZmZlY3RzICAgICAvL1xuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICQuYmFja2dyb3VuZE11c2ljID0gZ2FtZS5hZGQuYXVkaW8oJ2JhY2tncm91bmRNdXNpYycsIHRydWUpO1xuICAgICQuYmFja2dyb3VuZE11c2ljLnBsYXkoKTtcblxuICB9LFxuXG4gIHBsb3Q6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgJCA9IHRoaXM7XG5cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gICAgICBQYXRoIHBsb3QgaW5mbyBmb3IgdGhlIGVuZW15IHNwcml0ZXMgICAgICAvL1xuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICQucGF0aCA9IFtdO1xuICAgIHZhciBpeCA9IDA7XG4gICAgdmFyIHggPSAxIC8gKGdhbWUud2lkdGggKyAoJC5lbmVteVdhdmUubGVuZ3RoIC0gMSkgKiAxMDApO1xuXG4gICAgJC5wb2ludHM9IHtcbiAgICAgICd4JzogWy00NjYsIC00MTYsIC0zNjYsIC0zMTYsIC0yNjYsIC0yMTYsIC0xNTYsIC01NiwgLTE2LCAxMDAsIDIwMCwgMzAwLCA0MDAsIDUwMCwgNjAwLCA3MDAsIDc0MCwgNjc1LCA2MDAsIDUwMCwgNDAwLCAzMDAsIDIwNSwgMTgwLCAxOTAsIDI5MCwgMzkwLCA0OTAsIDU5MCwgNjkwLCA3OTAsIDg1MCwgODYwLCA4NjAsIDg2MCwgODYwLCA4NjAsIDg2MCwgODYwLCA4NjAsIDg2MCwgODYwXSxcbiAgICAgICd5JzogWzEzMCwgMTMwLCAxMzAsIDEzMCwgMTMwLCAxMzAsIDEzMCwgMTMwLCAxMzAsIDEzMCwgMTMwLCAxMzAsIDEzMCwgMTQ1LCAxNjAsIDE4MCwgMjUwLCAzMTAsIDM0MCwgMzUwLCAzNTAsIDM2NSwgNDAwLCA0NzUsIDU1MCwgNTkwLCA2MTAsIDYyMywgNjMwLCA2MzgsIDY1MCwgNzIwLCA4MDAsIDg1MCwgOTAwLCA5NTAsIDEwMDAsIDEwNTAsIDExMDAsIDExNTAsIDEyMDAsIDEyNTBdXG4gICAgfTtcblxuICAgICQucGkgPSAwO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gMTsgaSArPSB4KSB7XG5cbiAgICAgIHZhciBweCA9ICQubWF0aC5jYXRtdWxsUm9tSW50ZXJwb2xhdGlvbigkLnBvaW50cy54LCBpKTtcbiAgICAgIHZhciBweSA9ICQubWF0aC5jYXRtdWxsUm9tSW50ZXJwb2xhdGlvbigkLnBvaW50cy55LCBpKTtcblxuICAgICAgLy9UaGlzIGRyYXdzIHRoZSBwYXRoIG9udG8gdGhlIHNjcmVlbiB0byBlZGl0IHRoZSBwYXRoXG4gICAgICAvLyB0aGlzLmJtZC5yZWN0KHB4LCBweSwgMSwgMSwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMSknKTtcblxuICAgICAgdmFyIG5vZGUgPSB7eDogcHgsIHk6IHB5LCBhbmdsZTogMH07XG4gICAgICBpZiAoaXggPiAwKSB7XG4gICAgICAgIG5vZGUuYW5nbGUgPSAkLm1hdGguYW5nbGVCZXR3ZWVuUG9pbnRzKCQucGF0aFtpeCAtIDFdLCBub2RlKTtcbiAgICAgIH1cbiAgICAgICQucGF0aC5wdXNoKG5vZGUpO1xuICAgICAgaXgrKztcblxuICAgIH1cblxuICAgIC8vVGhpcyBkcmF3cyByZWN0YW5nbGVzIG9udG8gdGhlIHBhdGggd2hlcmUgdGhlIG5vZGVzIGFyZSBsb2NhdGVkXG4gICAgLy8gZm9yICh2YXIgcCA9IDA7IHAgPCB0aGlzLnBvaW50cy54Lmxlbmd0aDsgcCsrKSB7XG4gICAgLy8gICB0aGlzLmJtZC5yZWN0KHRoaXMucG9pbnRzLnhbcF0tMywgdGhpcy5wb2ludHMueVtwXS0zLCA2LCA2LCAncmdiYSgyNTUsIDAsIDAsIDEpJyk7XG4gICAgLy8gfVxuXG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbiAoKXtcbiAgICB2YXIgJCA9IHRoaXM7XG5cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gICAgIFBsYWNlcyBlbmVteSB0YW5rcyBpbnRvIHRoZSB3YXZlICAgICAvL1xuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkLmVuZW15V2F2ZS5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIG9mZnNldCA9ICQucGF0aFskLnBpICsgKCgkLmVuZW15V2F2ZS5sZW5ndGggLSAxKSAqIDQwIC0gaSAqIDQwKV07XG4gICAgICBpZiAoJC5lbmVteVdhdmVbOF0ueCAhPT0gODYwKSB7XG4gICAgICAgICQuZW5lbXlXYXZlW2ldLnggPSBvZmZzZXQueDtcbiAgICAgICAgJC5lbmVteVdhdmVbaV0ueSA9IG9mZnNldC55O1xuICAgICAgICAkLmVuZW15V2F2ZVtpXS5yb3RhdGlvbiA9IG9mZnNldC5hbmdsZTtcbiAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAkLnBpKys7XG4gICAgLy8gaWYgKHRoaXMucGkgPj0gdGhpcy5wYXRoLmxlbmd0aCkge1xuICAgIC8vICAgdGhpcy5waSA9IDA7XG4gICAgLy8gfVxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkLmVuZW15V2F2ZS5sZW5ndGg7IGkrKykge1xuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCAkLnR1cnJldFBvc2l0aW9uLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGlmICgkLnBoeXNpY3MuYXJjYWRlLmRpc3RhbmNlVG9YWSgkLmVuZW15V2F2ZVtpXSwgJC50dXJyZXRQb3NpdGlvbltqXS54LCAkLnR1cnJldFBvc2l0aW9uW2pdLnkpIDwgMjAwICYmICQuZW5lbXlXYXZlW2ldLmFsaXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgJC50dXJyZXRQb3NpdGlvbltqXS5yb3RhdGlvbiA9IGdhbWUucGh5c2ljcy5hcmNhZGUuYW5nbGVCZXR3ZWVuKCQudHVycmV0UG9zaXRpb25bal0sICQuZW5lbXlXYXZlW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vICAgICBDb2luIGtpbGwgZm9yIHR1cnJldCBmaXJlICAgICAvL1xuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIGZvciAodmFyIHkgPSAwOyB5IDwgMTA7IHkrKykge1xuICAgICAgaWYgKCQuY29pblBvc2l0aW9uW3ldLmFsaXZlID09PSBmYWxzZSkge1xuICAgICAgICAkLmFpbSh5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBnYW1lLnBoeXNpY3MuYXJjYWRlLm92ZXJsYXAoJC5idWxsZXRzLCAkLmVuZW1pZXMsICQuY29sbGlzaW9uSGFuZGxlcik7XG5cbiAgfSxcblxuICBwbGF5Q2FzaFJlZ2lzdGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgY29uc29sZS5sb2coXCJ3b3Jrc1wiKVxuXG4gIH0sXG5cbiAgY3JlYXRlVHVycmV0OiBmdW5jdGlvbiAoY29pbikge1xuICAgIGNvaW4ua2lsbCgpXG4gICAgdGhpcy5jYXNoUmVnaXN0ZXIgPSBnYW1lLmFkZC5hdWRpbygnY2FzaFJlZ2lzdGVyJyk7XG4gICAgdGhpcy5jYXNoUmVnaXN0ZXIucGxheSgpO1xuICB9LFxuXG4gIGNvbGxpc2lvbkhhbmRsZXI6IGZ1bmN0aW9uIChidWxsZXQsIGVuZW15KSB7XG4gICAgYnVsbGV0LmtpbGwoKTtcbiAgICAvLyBjb25zb2xlLmxvZyhlbmVteS5oZWFsdGgpO1xuICAgIGVuZW15LmhlYWx0aCAtPSAxO1xuICAgIGlmKGVuZW15LmhlYWx0aCA8PSAwKSB7XG4gICAgICB0aGlzLmV4cGxvc2lvblNvdW5kID0gZ2FtZS5hZGQuYXVkaW8oJ2V4cGxvc2lvbicpO1xuICAgICAgdGhpcy5leHBsb3Npb25Tb3VuZC5wbGF5KCk7XG4gICAgICBlbmVteS5raWxsKCk7XG4gICAgICB2YXIgZXhwbG9zaW9uID0gZXhwbG9zaW9ucy5nZXRGaXJzdEV4aXN0cyhmYWxzZSk7XG4gICAgICBleHBsb3Npb24ucmVzZXQoZW5lbXkuYm9keS54IC0gNzAsIGVuZW15LmJvZHkueSAtIDcwKTtcbiAgICAgIGV4cGxvc2lvbi5hbmltYXRpb25zLmFkZCgnZXhwbG9zaW9uJyk7XG4gICAgICBleHBsb3Npb24uYW5pbWF0aW9ucy5wbGF5KCdleHBsb3Npb24nKTtcbiAgICB9XG4gIH0sXG4gIGFpbTogZnVuY3Rpb24gKHgpIHtcbiAgICB2YXIgdHVyciA9IHRoaXMudHVycmV0UG9zaXRpb25beF07XG4gICAgaWYgKGdhbWUudGltZS5ub3cgPiBuZXh0RmlyZVt4XSAmJiB0aGlzLmJ1bGxldHMuY291bnREZWFkKCkgPiAwKSB7XG4gICAgICBuZXh0RmlyZVt4XSA9IGdhbWUudGltZS5ub3cgKyBmaXJlUmF0ZTtcbiAgICAgIHZhciBidWxsZXQgPSB0aGlzLmJ1bGxldHMuZ2V0Rmlyc3REZWFkKCk7XG4gICAgICBidWxsZXQuYW5jaG9yLnNldCgwLjUpO1xuICAgICAgYnVsbGV0LnJlc2V0KHR1cnIueCwgdHVyci55KTtcbiAgICAgIC8vVHJ5IGRlY3JpbWVudGluZyB0aGUgZnVuY3Rpb24gdG8gaGF2ZSBpdCBhaW0gYXQgdGhlIGZpcnN0IHR1cnJldFxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmVuZW15V2F2ZS5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgZW5lbSA9IHRoaXMuZW5lbXlXYXZlW2ldO1xuICAgICAgICBpZiAodGhpcy5waHlzaWNzLmFyY2FkZS5kaXN0YW5jZVRvWFkoZW5lbSwgdHVyci54LCB0dXJyLnkpIDwgMjAwICYmIGVuZW0uYWxpdmUgPT09IHRydWUgJiYgZW5lbS54ID4gMCAmJiBlbmVtLnkgPCA3NjgpIHtcbiAgICAgICAgICBidWxsZXQucm90YXRpb24gPSBnYW1lLnBoeXNpY3MuYXJjYWRlLmFuZ2xlQmV0d2Vlbih0dXJyLCBlbmVtKTtcbiAgICAgICAgICBnYW1lLnBoeXNpY3MuYXJjYWRlLm1vdmVUb09iamVjdChidWxsZXQsIGVuZW0sIDMwMCk7XG4gICAgICAgICAgdmFyIHNob3QgPSBnYW1lLmFkZC5hdWRpbygnc2hvdCcpO1xuICAgICAgICAgIHNob3QucGxheSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcblxuICAgIC8vIGdhbWUuZGVidWcudGV4dCgnQWN0aXZlIEJ1bGxldHM6ICcgKyB0aGlzLmJ1bGxldHMuY291bnRMaXZpbmcoKSArICcgLyAnICsgdGhpcy5idWxsZXRzLmNvdW50RGVhZCgpICsgJyAvICcgKyB0aGlzLmJ1bGxldHMudG90YWwsIDMyLCAzMik7XG4gICAgLy8gZ2FtZS5kZWJ1Zy50ZXh0KGdhbWUudGltZS5ub3cgKyAnIC8gJyArIG5leHRGaXJlLCAzMiwgNjQpXG5cbiAgfVxuXG59O1xuXG5nYW1lLnN0YXRlLmFkZCgnR2FtZScsIFBoYXNlckdhbWUuR2FtZSk7XG5cbmdhbWUuc3RhdGUuc3RhcnQoJ0Jvb3QnKTtcbiJdfQ==
