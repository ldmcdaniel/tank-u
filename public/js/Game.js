'use strict';

var explosions, score, waveNumber, startingMoney, startingWaveNumber, startingScore;
var fireRate = 300;
var nextFire = [];
for (var i = 0; i < 10; i++) {
  nextFire[i] = 0;
}
var money = 40;

PhaserGame.Game = function (game) {
  // this.weapons = [];
};

PhaserGame.Game.prototype = {
  create: function create() {
    var $ = this;
    ///////////////////////////////////////
    //      Map and Layers Creation      //
    ///////////////////////////////////////
    var map = this.add.tilemap('map');
    //First param :name of tileset from tiled; second: game.load.image
    map.addTilesetImage('terrain_atlas', 'terrain');
    map.addTilesetImage('turrets32', 'turrets');
    $.road = map.createLayer('Road');
    $.grass = map.createLayer('Grass');
    $.trees = map.createLayer('Tree bases');
    ////////////////////////////////////////////////////////
    //      Enemy sprite and travel path information      //
    ////////////////////////////////////////////////////////
    $.enemies = game.add.group();
    $.enemies.hp = 3;
    $.enemies.enableBody = true;
    $.enemies.physicsBodyType = Phaser.Physics.ARCADE;
    $.enemyWave = ['tank1', 'tank2', 'tank3', 'tank4', 'tank5', 'tank6', 'tank7', 'tank8', 'tank9'];
    for (var i = 0; i < $.enemyWave.length; i++) {
      $.enemyWave[i] = $.enemies.create(-16, 116, $.enemyWave[i]);
      $.enemyWave[i].anchor.set(0.5);
      $.enemyWave[i].animations.add('explosion', false);
      $.enemyWave[i].health = 10;
    }
    ///////////////////////
    //      Bullets      //
    ///////////////////////
    $.bullets = game.add.group();
    $.bullets.enableBody = true;
    $.bullets.physicsBodyType = Phaser.Physics.ARCADE;
    $.bullets.createMultiple(500, 'bullet1');
    $.bullets.setAll('checkWorldBounds', true);
    $.bullets.setAll('outOfBoundsKill', true);
    ///////////////////////////////
    //     Turrets and Coins     //
    ///////////////////////////////
    $.guns = game.add.group();
    $.turretPosition = ['turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1', 'turret1'];
    $.coinPosition = ['coin', 'coin', 'coin', 'coin', 'coin', 'coin', 'coin', 'coin', 'coin', 'coin'];
    $.turretSpots = {
      'x': [352, 800, 256, 448, 96, 320, 128, 354, 832, 864],
      'y': [32, 96, 256, 256, 320, 480, 640, 704, 384, 544]
    };
    for (var i = 0; i < this.turretPosition.length; i++) {
      $.turretPosition[i] = $.guns.create($.turretSpots.x[i], $.turretSpots.y[i], $.turretPosition[i]);
      $.turretPosition[i].anchor.set(0.5);
      $.coinPosition[i] = game.add.button($.turretSpots.x[i], $.turretSpots.y[i], $.coinPosition[i], $.createTurret);
      $.coinPosition[i].anchor.set(0.5);
    }
    /////////////////////////////////
    //     Explosions and fire     //
    /////////////////////////////////
    explosions = game.add.group();
    explosions.createMultiple(20, 'explosion');
    ///////////////////////////////////////////////
    //      Add Bit Mad Data and Last Layer      //
    ///////////////////////////////////////////////
    $.bmd = $.add.bitmapData(game.width, game.height);
    $.bmd.addToWorld();
    $.plot();
    $.bridges = map.createLayer('Tree Tops and Bridges');
    ////////////////////////////////////////////////////
    //     Texts for Score, Money, and Wave Count     //
    ////////////////////////////////////////////////////
    startingMoney = 40;
    startingScore = 0;
    startingWaveNumber = 1;
    score = game.add.text(820, 10, 'Score:');
    money = game.add.text(412, 10, "$ 40");
    waveNumber = game.add.text(30, 10, 'Wave 1');
    /////////////////////////////////////
    //     Music and Sound Effects     //
    /////////////////////////////////////
    $.backgroundMusic = game.add.audio('backgroundMusic', true);
    $.backgroundMusic.play();
  },
  plot: function plot() {
    var $ = this;
    ////////////////////////////////////////////////////
    //      Path plot info for the enemy sprites      //
    ////////////////////////////////////////////////////
    $.path = [];
    var ix = 0;
    var x = 1 / (game.width + ($.enemyWave.length - 1) * 100);
    $.points = {
      'x': [-466, -416, -366, -316, -266, -216, -156, -56, -16, 100, 200, 300, 400, 500, 600, 700, 740, 675, 600, 500, 400, 300, 205, 180, 190, 290, 390, 490, 590, 690, 790, 850, 860, 860, 860, 860, 860, 860, 860, 860, 860, 860],
      'y': [130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 145, 160, 180, 250, 310, 340, 350, 350, 365, 400, 475, 550, 590, 610, 623, 630, 638, 650, 720, 800, 850, 900, 950, 1000, 1050, 1100, 1150, 1200, 1250]
    };
    $.pi = 0;
    for (var i = 0; i <= 1; i += x) {
      var px = $.math.catmullRomInterpolation($.points.x, i);
      var py = $.math.catmullRomInterpolation($.points.y, i);
      //This draws the path onto the screen to edit the path
      // this.bmd.rect(px, py, 1, 1, 'rgba(255, 255, 255, 1)');
      var node = { x: px, y: py, angle: 0 };
      if (ix > 0) {
        node.angle = $.math.angleBetweenPoints($.path[ix - 1], node);
      }
      $.path.push(node);
      ix++;
    }
    //This draws rectangles onto the path where the nodes are located
    // for (var p = 0; p < this.points.x.length; p++) {
    //   this.bmd.rect(this.points.x[p]-3, this.points.y[p]-3, 6, 6, 'rgba(255, 0, 0, 1)');
    // }
  },
  update: function update() {
    var $ = this;
    //////////////////////////////////////////////
    //     Places enemy tanks into the wave     //
    //////////////////////////////////////////////
    for (var i = 0; i < $.enemyWave.length; i++) {
      var offset = $.path[$.pi + (($.enemyWave.length - 1) * 40 - i * 40)];
      if ($.enemyWave[8].x !== 860) {
        $.enemyWave[i].x = offset.x;
        $.enemyWave[i].y = offset.y;
        $.enemyWave[i].rotation = offset.angle;
      }
    };
    $.pi++;
    // if (this.pi >= this.path.length) {
    //   this.pi = 0;
    // }
    for (var i = 0; i < $.enemyWave.length; i++) {
      for (var j = 0; j < $.turretPosition.length; j++) {
        if ($.physics.arcade.distanceToXY($.enemyWave[i], $.turretPosition[j].x, $.turretPosition[j].y) < 200 && $.enemyWave[i].alive === true) {
          $.turretPosition[j].rotation = game.physics.arcade.angleBetween($.turretPosition[j], $.enemyWave[i]);
        }
      }
    }
    ///////////////////////////////////////
    //     Coin kill for turret fire     //
    ///////////////////////////////////////
    for (var y = 0; y < 10; y++) {
      if ($.coinPosition[y].alive === false) {
        $.aim(y);
      }
    }
    game.physics.arcade.overlap($.bullets, $.enemies, $.collisionHandler);
  },
  playCashRegister: function playCashRegister() {
    console.log("works");
  },
  createTurret: function createTurret(coin) {
    coin.kill();
    this.cashRegister = game.add.audio('cashRegister');
    this.cashRegister.play();
  },
  collisionHandler: function collisionHandler(bullet, enemy) {
    bullet.kill();
    // console.log(enemy.health);
    enemy.health -= 1;
    if (enemy.health <= 0) {
      this.explosionSound = game.add.audio('explosion');
      this.explosionSound.play();
      enemy.kill();
      var explosion = explosions.getFirstExists(false);
      explosion.reset(enemy.body.x - 70, enemy.body.y - 70);
      explosion.animations.add('explosion');
      explosion.animations.play('explosion');
    }
  },
  aim: function aim(x) {
    var turr = this.turretPosition[x];
    if (game.time.now > nextFire[x] && this.bullets.countDead() > 0) {
      nextFire[x] = game.time.now + fireRate;
      var bullet = this.bullets.getFirstDead();
      bullet.anchor.set(0.5);
      bullet.reset(turr.x, turr.y);
      //Try decrimenting the function to have it aim at the first turret
      for (var i = 0; i < this.enemyWave.length; i++) {
        var enem = this.enemyWave[i];
        if (this.physics.arcade.distanceToXY(enem, turr.x, turr.y) < 200 && enem.alive === true && enem.x > 0 && enem.y < 768) {
          bullet.rotation = game.physics.arcade.angleBetween(turr, enem);
          game.physics.arcade.moveToObject(bullet, enem, 300);
          var shot = game.add.audio('shot');
          shot.play();
        }
      }
    }
  },
  render: function render() {
    // game.debug.text('Active Bullets: ' + this.bullets.countLiving() + ' / ' + this.bullets.countDead() + ' / ' + this.bullets.total, 32, 32);
    // game.debug.text(game.time.now + ' / ' + nextFire, 32, 64)
  }
};

game.state.add('Game', PhaserGame.Game);
game.state.start('Boot');
//# sourceMappingURL=data:application/json;base64,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RUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0FBQzlOLFNBQUcsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO0tBQzlOLENBQUM7QUFDRixLQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztBQUNULFNBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FB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QUMsQ0FBQyxHQUFHLEdBQUcsSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLElBQUksSUFBSSxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxHQUFHLEdBQUcsRUFBRTtBQUNySCxnQkFBTSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQy9ELGNBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQ3BELGNBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ2xDLGNBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztTQUNiO09BQ0Y7S0FDRjtHQUNGO0FBQ0QsUUFBTSxFQUFFLGtCQUFZOzs7R0FHbkI7Q0FDRixDQUFDOztBQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDeEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMiLCJmaWxlIjoiR2FtZS5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBleHBsb3Npb25zLCBzY29yZSwgd2F2ZU51bWJlciwgc3RhcnRpbmdNb25leSwgc3RhcnRpbmdXYXZlTnVtYmVyLCBzdGFydGluZ1Njb3JlO1xudmFyIGZpcmVSYXRlID0gMzAwO1xudmFyIG5leHRGaXJlID0gW107XG5mb3IodmFyIGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICBuZXh0RmlyZVtpXSA9IDA7XG59XG52YXIgbW9uZXkgPSA0MDtcblxuUGhhc2VyR2FtZS5HYW1lID0gZnVuY3Rpb24gKGdhbWUpIHtcbiAgLy8gdGhpcy53ZWFwb25zID0gW107XG59XG5cblBoYXNlckdhbWUuR2FtZS5wcm90b3R5cGUgPSB7XG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciAkID0gdGhpcztcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyAgICAgIE1hcCBhbmQgTGF5ZXJzIENyZWF0aW9uICAgICAgLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICB2YXIgbWFwID0gdGhpcy5hZGQudGlsZW1hcCgnbWFwJyk7XG4gICAgICAvL0ZpcnN0IHBhcmFtIDpuYW1lIG9mIHRpbGVzZXQgZnJvbSB0aWxlZDsgc2Vjb25kOiBnYW1lLmxvYWQuaW1hZ2VcbiAgICBtYXAuYWRkVGlsZXNldEltYWdlKCd0ZXJyYWluX2F0bGFzJywgJ3RlcnJhaW4nKTtcbiAgICBtYXAuYWRkVGlsZXNldEltYWdlKCd0dXJyZXRzMzInLCAndHVycmV0cycpO1xuICAgICQucm9hZCA9IG1hcC5jcmVhdGVMYXllcignUm9hZCcpO1xuICAgICQuZ3Jhc3MgPSBtYXAuY3JlYXRlTGF5ZXIoJ0dyYXNzJyk7XG4gICAgJC50cmVlcyA9IG1hcC5jcmVhdGVMYXllcignVHJlZSBiYXNlcycpO1xuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gICAgICBFbmVteSBzcHJpdGUgYW5kIHRyYXZlbCBwYXRoIGluZm9ybWF0aW9uICAgICAgLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICQuZW5lbWllcyA9IGdhbWUuYWRkLmdyb3VwKCk7XG4gICAgJC5lbmVtaWVzLmhwID0gMztcbiAgICAkLmVuZW1pZXMuZW5hYmxlQm9keSA9IHRydWU7XG4gICAgJC5lbmVtaWVzLnBoeXNpY3NCb2R5VHlwZSA9IFBoYXNlci5QaHlzaWNzLkFSQ0FERTtcbiAgICAkLmVuZW15V2F2ZSA9IFsndGFuazEnLCAndGFuazInLCAndGFuazMnLCAndGFuazQnLCAndGFuazUnLCAndGFuazYnLCAndGFuazcnLCAndGFuazgnLCAndGFuazknXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8ICQuZW5lbXlXYXZlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAkLmVuZW15V2F2ZVtpXSA9ICQuZW5lbWllcy5jcmVhdGUoLTE2LCAxMTYsICQuZW5lbXlXYXZlW2ldKTtcbiAgICAgICQuZW5lbXlXYXZlW2ldLmFuY2hvci5zZXQoMC41KTtcbiAgICAgICQuZW5lbXlXYXZlW2ldLmFuaW1hdGlvbnMuYWRkKCdleHBsb3Npb24nLCBmYWxzZSk7XG4gICAgICAkLmVuZW15V2F2ZVtpXS5oZWFsdGggPSAxMDtcbiAgICB9XG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyAgICAgIEJ1bGxldHMgICAgICAvL1xuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgJC5idWxsZXRzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgICAkLmJ1bGxldHMuZW5hYmxlQm9keSA9IHRydWU7XG4gICAgJC5idWxsZXRzLnBoeXNpY3NCb2R5VHlwZSA9IFBoYXNlci5QaHlzaWNzLkFSQ0FERTtcbiAgICAkLmJ1bGxldHMuY3JlYXRlTXVsdGlwbGUoNTAwLCAnYnVsbGV0MScpO1xuICAgICQuYnVsbGV0cy5zZXRBbGwoJ2NoZWNrV29ybGRCb3VuZHMnLCB0cnVlKTtcbiAgICAkLmJ1bGxldHMuc2V0QWxsKCdvdXRPZkJvdW5kc0tpbGwnLCB0cnVlKTtcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gICAgIFR1cnJldHMgYW5kIENvaW5zICAgICAvL1xuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAkLmd1bnMgPSBnYW1lLmFkZC5ncm91cCgpO1xuICAgICQudHVycmV0UG9zaXRpb24gPSBbJ3R1cnJldDEnLCAndHVycmV0MScsICd0dXJyZXQxJywgJ3R1cnJldDEnLCAndHVycmV0MScsICd0dXJyZXQxJywgJ3R1cnJldDEnLCAndHVycmV0MScsICd0dXJyZXQxJywgJ3R1cnJldDEnXVxuICAgICQuY29pblBvc2l0aW9uID0gWydjb2luJywgJ2NvaW4nLCAnY29pbicsICdjb2luJywgJ2NvaW4nLCAnY29pbicsICdjb2luJywgJ2NvaW4nLCAnY29pbicsICdjb2luJ11cbiAgICAkLnR1cnJldFNwb3RzID0ge1xuICAgICAgJ3gnIDogWzM1MiwgODAwLCAyNTYsIDQ0OCwgOTYsIDMyMCwgMTI4LCAzNTQsIDgzMiwgODY0XSxcbiAgICAgICd5JyA6IFszMiwgOTYsIDI1NiwgMjU2LCAzMjAsIDQ4MCwgNjQwLCA3MDQsIDM4NCwgNTQ0XVxuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudHVycmV0UG9zaXRpb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgICQudHVycmV0UG9zaXRpb25baV0gPSAkLmd1bnMuY3JlYXRlKCQudHVycmV0U3BvdHMueFtpXSwgJC50dXJyZXRTcG90cy55W2ldLCAkLnR1cnJldFBvc2l0aW9uW2ldKTtcbiAgICAgICQudHVycmV0UG9zaXRpb25baV0uYW5jaG9yLnNldCgwLjUpO1xuICAgICAgJC5jb2luUG9zaXRpb25baV0gPSBnYW1lLmFkZC5idXR0b24oJC50dXJyZXRTcG90cy54W2ldLCAkLnR1cnJldFNwb3RzLnlbaV0sICQuY29pblBvc2l0aW9uW2ldLCAkLmNyZWF0ZVR1cnJldCk7XG4gICAgICAkLmNvaW5Qb3NpdGlvbltpXS5hbmNob3Iuc2V0KDAuNSk7XG4gICAgfVxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vICAgICBFeHBsb3Npb25zIGFuZCBmaXJlICAgICAvL1xuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIGV4cGxvc2lvbnMgPSBnYW1lLmFkZC5ncm91cCgpO1xuICAgIGV4cGxvc2lvbnMuY3JlYXRlTXVsdGlwbGUoMjAsICdleHBsb3Npb24nKTtcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vICAgICAgQWRkIEJpdCBNYWQgRGF0YSBhbmQgTGFzdCBMYXllciAgICAgIC8vXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAkLmJtZCA9ICQuYWRkLmJpdG1hcERhdGEoZ2FtZS53aWR0aCwgZ2FtZS5oZWlnaHQpO1xuICAgICQuYm1kLmFkZFRvV29ybGQoKTtcbiAgICAkLnBsb3QoKTtcbiAgICAkLmJyaWRnZXMgPSBtYXAuY3JlYXRlTGF5ZXIoJ1RyZWUgVG9wcyBhbmQgQnJpZGdlcycpO1xuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyAgICAgVGV4dHMgZm9yIFNjb3JlLCBNb25leSwgYW5kIFdhdmUgQ291bnQgICAgIC8vXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIHN0YXJ0aW5nTW9uZXkgPSA0MDtcbiAgICBzdGFydGluZ1Njb3JlID0gMDtcbiAgICBzdGFydGluZ1dhdmVOdW1iZXIgPSAxO1xuICAgIHNjb3JlID0gZ2FtZS5hZGQudGV4dCg4MjAsIDEwLCAnU2NvcmU6Jyk7XG4gICAgbW9uZXkgPSBnYW1lLmFkZC50ZXh0KDQxMiwgMTAsIFwiJCA0MFwiKTtcbiAgICB3YXZlTnVtYmVyID0gZ2FtZS5hZGQudGV4dCgzMCwgMTAsICdXYXZlIDEnKTtcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gICAgIE11c2ljIGFuZCBTb3VuZCBFZmZlY3RzICAgICAvL1xuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAkLmJhY2tncm91bmRNdXNpYyA9IGdhbWUuYWRkLmF1ZGlvKCdiYWNrZ3JvdW5kTXVzaWMnLCB0cnVlKTtcbiAgICAkLmJhY2tncm91bmRNdXNpYy5wbGF5KCk7XG4gIH0sXG4gIHBsb3Q6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgJCA9IHRoaXM7XG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vICAgICAgUGF0aCBwbG90IGluZm8gZm9yIHRoZSBlbmVteSBzcHJpdGVzICAgICAgLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgJC5wYXRoID0gW107XG4gICAgdmFyIGl4ID0gMDtcbiAgICB2YXIgeCA9IDEgLyAoZ2FtZS53aWR0aCArICgkLmVuZW15V2F2ZS5sZW5ndGggLSAxKSAqIDEwMCk7XG4gICAgJC5wb2ludHM9IHtcbiAgICAgICd4JzogWy00NjYsIC00MTYsIC0zNjYsIC0zMTYsIC0yNjYsIC0yMTYsIC0xNTYsIC01NiwgLTE2LCAxMDAsIDIwMCwgMzAwLCA0MDAsIDUwMCwgNjAwLCA3MDAsIDc0MCwgNjc1LCA2MDAsIDUwMCwgNDAwLCAzMDAsIDIwNSwgMTgwLCAxOTAsIDI5MCwgMzkwLCA0OTAsIDU5MCwgNjkwLCA3OTAsIDg1MCwgODYwLCA4NjAsIDg2MCwgODYwLCA4NjAsIDg2MCwgODYwLCA4NjAsIDg2MCwgODYwXSxcbiAgICAgICd5JzogWzEzMCwgMTMwLCAxMzAsIDEzMCwgMTMwLCAxMzAsIDEzMCwgMTMwLCAxMzAsIDEzMCwgMTMwLCAxMzAsIDEzMCwgMTQ1LCAxNjAsIDE4MCwgMjUwLCAzMTAsIDM0MCwgMzUwLCAzNTAsIDM2NSwgNDAwLCA0NzUsIDU1MCwgNTkwLCA2MTAsIDYyMywgNjMwLCA2MzgsIDY1MCwgNzIwLCA4MDAsIDg1MCwgOTAwLCA5NTAsIDEwMDAsIDEwNTAsIDExMDAsIDExNTAsIDEyMDAsIDEyNTBdXG4gICAgfTtcbiAgICAkLnBpID0gMDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8PSAxOyBpICs9IHgpIHtcbiAgICAgIHZhciBweCA9ICQubWF0aC5jYXRtdWxsUm9tSW50ZXJwb2xhdGlvbigkLnBvaW50cy54LCBpKTtcbiAgICAgIHZhciBweSA9ICQubWF0aC5jYXRtdWxsUm9tSW50ZXJwb2xhdGlvbigkLnBvaW50cy55LCBpKTtcbiAgICAgIC8vVGhpcyBkcmF3cyB0aGUgcGF0aCBvbnRvIHRoZSBzY3JlZW4gdG8gZWRpdCB0aGUgcGF0aFxuICAgICAgLy8gdGhpcy5ibWQucmVjdChweCwgcHksIDEsIDEsICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDEpJyk7XG4gICAgICB2YXIgbm9kZSA9IHt4OiBweCwgeTogcHksIGFuZ2xlOiAwfTtcbiAgICAgIGlmIChpeCA+IDApIHtcbiAgICAgICAgbm9kZS5hbmdsZSA9ICQubWF0aC5hbmdsZUJldHdlZW5Qb2ludHMoJC5wYXRoW2l4IC0gMV0sIG5vZGUpO1xuICAgICAgfVxuICAgICAgJC5wYXRoLnB1c2gobm9kZSk7XG4gICAgICBpeCsrO1xuICAgIH1cbiAgICAvL1RoaXMgZHJhd3MgcmVjdGFuZ2xlcyBvbnRvIHRoZSBwYXRoIHdoZXJlIHRoZSBub2RlcyBhcmUgbG9jYXRlZFxuICAgIC8vIGZvciAodmFyIHAgPSAwOyBwIDwgdGhpcy5wb2ludHMueC5sZW5ndGg7IHArKykge1xuICAgIC8vICAgdGhpcy5ibWQucmVjdCh0aGlzLnBvaW50cy54W3BdLTMsIHRoaXMucG9pbnRzLnlbcF0tMywgNiwgNiwgJ3JnYmEoMjU1LCAwLCAwLCAxKScpO1xuICAgIC8vIH1cbiAgfSxcbiAgdXBkYXRlOiBmdW5jdGlvbiAoKXtcbiAgICB2YXIgJCA9IHRoaXM7XG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vICAgICBQbGFjZXMgZW5lbXkgdGFua3MgaW50byB0aGUgd2F2ZSAgICAgLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkLmVuZW15V2F2ZS5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIG9mZnNldCA9ICQucGF0aFskLnBpICsgKCgkLmVuZW15V2F2ZS5sZW5ndGggLSAxKSAqIDQwIC0gaSAqIDQwKV07XG4gICAgICBpZiAoJC5lbmVteVdhdmVbOF0ueCAhPT0gODYwKSB7XG4gICAgICAgICQuZW5lbXlXYXZlW2ldLnggPSBvZmZzZXQueDtcbiAgICAgICAgJC5lbmVteVdhdmVbaV0ueSA9IG9mZnNldC55O1xuICAgICAgICAkLmVuZW15V2F2ZVtpXS5yb3RhdGlvbiA9IG9mZnNldC5hbmdsZTtcbiAgICAgIH1cbiAgICB9O1xuICAgICQucGkrKztcbiAgICAvLyBpZiAodGhpcy5waSA+PSB0aGlzLnBhdGgubGVuZ3RoKSB7XG4gICAgLy8gICB0aGlzLnBpID0gMDtcbiAgICAvLyB9XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkLmVuZW15V2F2ZS5sZW5ndGg7IGkrKykge1xuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCAkLnR1cnJldFBvc2l0aW9uLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGlmICgkLnBoeXNpY3MuYXJjYWRlLmRpc3RhbmNlVG9YWSgkLmVuZW15V2F2ZVtpXSwgJC50dXJyZXRQb3NpdGlvbltqXS54LCAkLnR1cnJldFBvc2l0aW9uW2pdLnkpIDwgMjAwICYmICQuZW5lbXlXYXZlW2ldLmFsaXZlID09PSB0cnVlKSB7XG4gICAgICAgICAgJC50dXJyZXRQb3NpdGlvbltqXS5yb3RhdGlvbiA9IGdhbWUucGh5c2ljcy5hcmNhZGUuYW5nbGVCZXR3ZWVuKCQudHVycmV0UG9zaXRpb25bal0sICQuZW5lbXlXYXZlW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyAgICAgQ29pbiBraWxsIGZvciB0dXJyZXQgZmlyZSAgICAgLy9cbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICBmb3IgKHZhciB5ID0gMDsgeSA8IDEwOyB5KyspIHtcbiAgICAgIGlmICgkLmNvaW5Qb3NpdGlvblt5XS5hbGl2ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgJC5haW0oeSk7XG4gICAgICB9XG4gICAgfVxuICAgIGdhbWUucGh5c2ljcy5hcmNhZGUub3ZlcmxhcCgkLmJ1bGxldHMsICQuZW5lbWllcywgJC5jb2xsaXNpb25IYW5kbGVyKTtcbiAgfSxcbiAgcGxheUNhc2hSZWdpc3RlcjogZnVuY3Rpb24gKCkge1xuICAgIGNvbnNvbGUubG9nKFwid29ya3NcIik7XG4gIH0sXG4gIGNyZWF0ZVR1cnJldDogZnVuY3Rpb24gKGNvaW4pIHtcbiAgICBjb2luLmtpbGwoKVxuICAgIHRoaXMuY2FzaFJlZ2lzdGVyID0gZ2FtZS5hZGQuYXVkaW8oJ2Nhc2hSZWdpc3RlcicpO1xuICAgIHRoaXMuY2FzaFJlZ2lzdGVyLnBsYXkoKTtcbiAgfSxcbiAgY29sbGlzaW9uSGFuZGxlcjogZnVuY3Rpb24gKGJ1bGxldCwgZW5lbXkpIHtcbiAgICBidWxsZXQua2lsbCgpO1xuICAgIC8vIGNvbnNvbGUubG9nKGVuZW15LmhlYWx0aCk7XG4gICAgZW5lbXkuaGVhbHRoIC09IDE7XG4gICAgaWYoZW5lbXkuaGVhbHRoIDw9IDApIHtcbiAgICAgIHRoaXMuZXhwbG9zaW9uU291bmQgPSBnYW1lLmFkZC5hdWRpbygnZXhwbG9zaW9uJyk7XG4gICAgICB0aGlzLmV4cGxvc2lvblNvdW5kLnBsYXkoKTtcbiAgICAgIGVuZW15LmtpbGwoKTtcbiAgICAgIHZhciBleHBsb3Npb24gPSBleHBsb3Npb25zLmdldEZpcnN0RXhpc3RzKGZhbHNlKTtcbiAgICAgIGV4cGxvc2lvbi5yZXNldChlbmVteS5ib2R5LnggLSA3MCwgZW5lbXkuYm9keS55IC0gNzApO1xuICAgICAgZXhwbG9zaW9uLmFuaW1hdGlvbnMuYWRkKCdleHBsb3Npb24nKTtcbiAgICAgIGV4cGxvc2lvbi5hbmltYXRpb25zLnBsYXkoJ2V4cGxvc2lvbicpO1xuICAgIH1cbiAgfSxcbiAgYWltOiBmdW5jdGlvbiAoeCkge1xuICAgIHZhciB0dXJyID0gdGhpcy50dXJyZXRQb3NpdGlvblt4XTtcbiAgICBpZiAoZ2FtZS50aW1lLm5vdyA+IG5leHRGaXJlW3hdICYmIHRoaXMuYnVsbGV0cy5jb3VudERlYWQoKSA+IDApIHtcbiAgICAgIG5leHRGaXJlW3hdID0gZ2FtZS50aW1lLm5vdyArIGZpcmVSYXRlO1xuICAgICAgdmFyIGJ1bGxldCA9IHRoaXMuYnVsbGV0cy5nZXRGaXJzdERlYWQoKTtcbiAgICAgIGJ1bGxldC5hbmNob3Iuc2V0KDAuNSk7XG4gICAgICBidWxsZXQucmVzZXQodHVyci54LCB0dXJyLnkpO1xuICAgICAgLy9UcnkgZGVjcmltZW50aW5nIHRoZSBmdW5jdGlvbiB0byBoYXZlIGl0IGFpbSBhdCB0aGUgZmlyc3QgdHVycmV0XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZW5lbXlXYXZlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBlbmVtID0gdGhpcy5lbmVteVdhdmVbaV07XG4gICAgICAgIGlmICh0aGlzLnBoeXNpY3MuYXJjYWRlLmRpc3RhbmNlVG9YWShlbmVtLCB0dXJyLngsIHR1cnIueSkgPCAyMDAgJiYgZW5lbS5hbGl2ZSA9PT0gdHJ1ZSAmJiBlbmVtLnggPiAwICYmIGVuZW0ueSA8IDc2OCkge1xuICAgICAgICAgIGJ1bGxldC5yb3RhdGlvbiA9IGdhbWUucGh5c2ljcy5hcmNhZGUuYW5nbGVCZXR3ZWVuKHR1cnIsIGVuZW0pO1xuICAgICAgICAgIGdhbWUucGh5c2ljcy5hcmNhZGUubW92ZVRvT2JqZWN0KGJ1bGxldCwgZW5lbSwgMzAwKTtcbiAgICAgICAgICB2YXIgc2hvdCA9IGdhbWUuYWRkLmF1ZGlvKCdzaG90Jyk7XG4gICAgICAgICAgc2hvdC5wbGF5KCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHJlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgIC8vIGdhbWUuZGVidWcudGV4dCgnQWN0aXZlIEJ1bGxldHM6ICcgKyB0aGlzLmJ1bGxldHMuY291bnRMaXZpbmcoKSArICcgLyAnICsgdGhpcy5idWxsZXRzLmNvdW50RGVhZCgpICsgJyAvICcgKyB0aGlzLmJ1bGxldHMudG90YWwsIDMyLCAzMik7XG4gICAgLy8gZ2FtZS5kZWJ1Zy50ZXh0KGdhbWUudGltZS5ub3cgKyAnIC8gJyArIG5leHRGaXJlLCAzMiwgNjQpXG4gIH1cbn07XG5cbmdhbWUuc3RhdGUuYWRkKCdHYW1lJywgUGhhc2VyR2FtZS5HYW1lKTtcbmdhbWUuc3RhdGUuc3RhcnQoJ0Jvb3QnKTtcbiJdfQ==
